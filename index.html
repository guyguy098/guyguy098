<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta name="apple-mobile-web-app-capable" content="yes">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hamal Tatzpit</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">

<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
			height: auto;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: #4f46e5;
            text-decoration: none;
        }

        .logo-container {
			display: flex;
			align-items: center;
			gap: 1rem;
		}

		.hamburger-btn-main {
			background: rgba(79, 70, 229, 0.8);
			border: none;
			padding: 0.6rem 0.8rem;
			border-radius: 8px;
			color: white;
			font-size: 1.2rem;
			cursor: pointer;
			transition: all 0.3s ease;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.hamburger-btn-main:hover {
			background: rgba(79, 70, 229, 1);
			transform: scale(1.05);
		}

		.controls {
			display: flex;
			align-items: center;
			gap: 2rem;
		}

        .region-filters {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .region-filter {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .region-filter:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .region-filter.active {
            background: rgba(79, 70, 229, 0.6);
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.3);
        }

        .region-filter input {
            display: none;
        }

        .grid-selector {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
        }

        .grid-selector option {
            background: #1a1a2e;
            color: white;
        }

        .bandwidth-monitor {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .bandwidth-value {
            color: #4f46e5;
            font-weight: 600;
        }

        .tool-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tool-select {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            font-size: 0.9rem;
            min-width: 150px;
        }

        .tool-select option {
            background: #1a1a2e;
            color: white;
        }

        .search-input {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            font-size: 0.9rem;
            width: 200px;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .main-content {
			padding-top: 120px;
			padding-left: 2rem;
			padding-right: 2rem;
			padding-bottom: 1rem;
			max-width: 1400px;
			margin: 0 auto;
		}

        .grid-container {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(3, 1fr);
            margin-top: 2rem;
        }

        .video-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .video-container:hover {
			border: 3px solid #4f46e5;
			box-shadow: 0 8px 32px rgba(79, 70, 229, 0.4);
		}

        .video-header {
            padding: 1rem;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .video-title {
            font-size: 0.9rem;
            font-weight: 500;
            color: white;
        }

        .country-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-arab { background: rgba(255, 87, 87, 0.2); color: #ff5757; }
        .badge-israel { background: rgba(255, 215, 0, 0.2); color: #ffd700; }
        .badge-usa { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .badge-iran { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .badge-world { background: rgba(168, 85, 247, 0.2); color: #a855f7; }

        .video-element {
            width: 100%;
            height: auto;
            aspect-ratio: 16/9;
            background: #000;
            display: block;
        }

        .video-element.playing {
            pointer-events: auto;
        }

        .play-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(79, 70, 229, 0.8);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .play-overlay:hover {
            background: rgba(79, 70, 229, 1);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .play-overlay i {
            color: white;
            font-size: 1.5rem;
            margin-left: 3px;
        }

        .video-container.playing .play-overlay {
            display: none;
        }

        .video-container.hidden {
            display: none;
        }
		.custom-layout-overlay {
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.7);
			z-index: 2000;
			justify-content: center;
			align-items: center;
		}

		.custom-layout-overlay.active {
			display: flex;
		}

		.custom-layout-controls {
			background: #1a1a2e;
			border: 1px solid rgba(255, 255, 255, 0.1);
			border-radius: 12px;
			padding: 1.5rem;
			width: 90%;
			max-width: 800px;
			max-height: 80vh;
			overflow-y: auto;
			position: relative;
		}

		.custom-layout-controls.active {
			display: block;
		}

		.custom-layout-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 1.5rem;
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
			padding-bottom: 1rem;
		}

		.custom-layout-header h3 {
			color: white;
			margin: 0;
			font-size: 1.2rem;
		}

		.custom-layout-close {
			background: none;
			border: none;
			color: white;
			font-size: 1.5rem;
			cursor: pointer;
			padding: 0;
			line-height: 1;
		}
        .stats-bar {
			background: rgba(0, 0, 0, 0.6);
			backdrop-filter: blur(10px);
			padding: 1rem 2rem;
			border-radius: 0;
			display: flex;
			justify-content: space-between;
			align-items: center;
			position: fixed;
			width: 100%;
			left: 0;
			top: 60px;
			z-index: 998;
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
			box-sizing: border-box;
		}

		.stats-bar-content {
			display: flex;
			justify-content: space-between;
			align-items: center;
			max-width: 1400px;
			margin: 0 auto;
			width: 100%;
		}

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-value {
            font-weight: 600;
            color: #4f46e5;
        }

        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Grid variations */
        .grid-3xY { grid-template-columns: repeat(3, 1fr); }
        .grid-1xY { grid-template-columns: repeat(1, 1fr); }
		.grid-2xY { grid-template-columns: repeat(2, 1fr); }
        .grid-4xY { grid-template-columns: repeat(4, 1fr); }
        .grid-5xY { grid-template-columns: repeat(5, 1fr); }

        /* For medium screens - tablets and narrow desktop */
		@media (max-width: 1200px) {
			.header-content {
				flex-direction: row;
				gap: 0.5rem;
				flex-wrap: wrap;
			}
			
			.logo {
				font-size: 1.4rem;
				flex: 1;
			}
			
			/* Hide text in region filters, show only emojis */
			.region-filter span {
				font-size: 1.3rem;
			}
			
			.region-filters {
				gap: 0.3rem;
			}
			
			.region-filter {
				padding: 0.4rem 0.6rem;
				min-width: auto;
			}
			
			/* Hide secondary header tools */
			.secondary-left {
				display: none;
			}
			
			.secondary-content {
				justify-content: flex-end;
			}
			
			/* Simplify stats bar */
			.stat-item {
				font-size: 0.85rem;
			}
			
			.stat-item:nth-child(2) {
				display: none; /* Hide Traffic Saved */
			}

			.header {
				padding: 0.75rem 1rem;
				height: auto;
			}
			
			.secondary-header {
				padding: 0.75rem 1rem;
				height: auto;
			}
		}

		/* Mobile Sidebar */
		.mobile-sidebar {
			position: fixed;
			left: 0px;
			top: 0;
			width: 320px;
			height: 100vh;
			background: rgba(26, 26, 46, 0.98);
			backdrop-filter: blur(10px);
			z-index: 2000;
			transform: translateX(-120%);
			transition: transform 0.3s ease;
			overflow-y: auto;
			box-shadow: -5px 0 20px rgba(0, 0, 0, 0.5);
		}

		.mobile-sidebar.active {
			transform: translateX(0);
		}

		.mobile-menu-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100vh;
			background: rgba(0, 0, 0, 0.7);
			z-index: 1999;
			display: none;
		}

		.mobile-menu-overlay.active {
			display: block;
		}

		.mobile-sidebar-header {
			background: rgba(0, 0, 0, 0.9);
			padding: 1.5rem;
			display: flex;
			justify-content: space-between;
			align-items: center;
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
		}

		.close-sidebar {
			background: none;
			border: none;
			color: white;
			font-size: 1.5rem;
			cursor: pointer;
			padding: 0;
			width: 30px;
			height: 30px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.mobile-sidebar-content {
			padding: 1.5rem;
		}

		.mobile-tool-section {
			margin-bottom: 2rem;
		}

		.mobile-tool-section h4 {
			color: rgba(255, 255, 255, 0.9);
			font-size: 1rem;
			margin-bottom: 1rem;
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		.mobile-tool-select,
		.mobile-search-input {
			width: 100%;
			padding: 0.75rem;
			background: rgba(255, 255, 255, 0.1);
			border: 1px solid rgba(255, 255, 255, 0.2);
			border-radius: 6px;
			color: white;
			font-size: 0.9rem;
			direction: ltr;
			text-align: left;
			unicode-bidi: isolate;
		}

		.mobile-tool-select {
			direction: ltr;
			text-align: left;
		}

		.mobile-tool-select option {
			background: #1a1a2e;
			color: white;
			direction: ltr;
			text-align: left;
		}

		.mobile-search-input::placeholder {
			color: rgba(255, 255, 255, 0.6);
		}

		/* Mobile phones */
		@media (max-width: 768px) {

			/* ── Header ── */
			.header {
				padding: 0.5rem 0.75rem;
				height: auto;
			}

			.header-content {
				flex-direction: row;
				gap: 0.5rem;
				flex-wrap: wrap;
				align-items: center;
			}

			.logo {
				font-size: 1rem;
				flex: 1;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
			}

			/* Hide grid selector on mobile */
			#gridSelector {
				display: none;
			}

			/* Bigger touch targets for region filters */
			.region-filters {
				gap: 0.25rem;
				flex-wrap: wrap;
				width: 100%;
			}

			.region-filter {
				padding: 0.5rem;
				min-width: 36px;
				min-height: 36px;
				display: flex;
				align-items: center;
				justify-content: center;
				border-radius: 8px;
			}

			.region-filter img {
				width: 22px;
				height: 16px;
			}

			.custom-layout-btn {
				padding: 0.5rem;
				min-width: 36px;
				min-height: 36px;
			}

			/* ── Stats Bar ── */
			.stats-bar {
				padding: 0.4rem 1rem;
			}

			.stats-bar-content {
				gap: 0.5rem;
				flex-wrap: nowrap;
				justify-content: space-between;
				width: 100%;
			}

			.stat-item {
				font-size: 0.75rem;
			}

			.stat-item:nth-child(2) {
				display: none;
			}

			/* ── Main Content ── */
			.main-content {
				padding-top: 110px;
				padding-left: 0.5rem;
				padding-right: 0.5rem;
			}

			/* ── Grid ── */
			.grid-container {
				grid-template-columns: 1fr !important;
				gap: 0.75rem;
				margin-top: 1rem;
			}

			/* ── Video Containers ── */
			.video-container {
				border-radius: 8px;
			}

			.video-header {
				padding: 0.6rem 0.75rem;
			}

			.video-title {
				font-size: 0.85rem;
			}

			.country-badge {
				font-size: 0.7rem;
				padding: 0.2rem 0.5rem;
			}

			/* Bigger play button for touch */
			.play-overlay {
				width: 72px;
				height: 72px;
			}

			.play-overlay i {
				font-size: 2rem;
			}

			/* ── Mobile Sidebar ── */
			.mobile-sidebar {
				width: 85%;
				max-width: 320px;
			}

			.mobile-sidebar-content {
				padding: 1rem;
			}

			/* font-size 1rem prevents iOS auto-zoom on input focus */
			.mobile-tool-select,
			.mobile-search-input {
				font-size: 1rem;
				padding: 0.85rem;
				border-radius: 8px;
			}

			.mobile-tool-section h4 {
				font-size: 0.95rem;
			}

			/* ── Custom Layout Overlay ── */
			.custom-layout-controls {
				width: 95%;
				max-height: 85vh;
				padding: 1rem;
			}

			.channel-picker {
				grid-template-columns: 1fr 1fr;
				gap: 0.5rem;
			}

			.channel-option {
				font-size: 0.8rem;
				padding: 0.4rem;
			}

			.custom-btn {
				padding: 0.6rem 0.8rem;
				font-size: 0.85rem;
			}
		}
		
		.channel-picker {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 0.75rem;
			margin-bottom: 1.5rem;
		}
		.channel-option {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.6rem 0.75rem;
			background: rgba(255,255,255,0.05);
			border: 1px solid rgba(255,255,255,0.1);
			border-radius: 8px;
			cursor: pointer;
			font-size: 0.82rem;
			color: rgba(255,255,255,0.7);
			transition: all 0.2s;
			user-select: none;
		}
		.channel-option:hover {
			background: rgba(255,255,255,0.1);
			border-color: rgba(255,255,255,0.2);
		}
		.channel-option.selected {
			background: rgba(79,70,229,0.2);
			border-color: rgba(79,70,229,0.6);
			color: white;
		}
		.channel-option input[type="checkbox"] {
			display: none;
		}
		.custom-controls {
			display: flex;
			gap: 0.75rem;
			padding-top: 1rem;
			border-top: 1px solid rgba(255,255,255,0.1);
			flex-wrap: wrap;
		}
		.custom-btn {
			padding: 0.6rem 1.2rem;
			background: rgba(79,70,229,0.7);
			border: none;
			border-radius: 8px;
			color: white;
			font-size: 0.9rem;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s;
		}
		.custom-btn:hover {
			background: rgba(79,70,229,1);
		}
		.custom-btn:disabled {
			opacity: 0.4;
			cursor: not-allowed;
		}

		/* ── Phone Landscape ── */
		@media (max-width: 900px) and (orientation: landscape) {

			/* Header is too tall in landscape, compress it */
			.header {
				padding: 0.3rem 0.75rem;
			}

			.logo {
				font-size: 0.95rem;
			}

			.region-filter {
				padding: 0.3rem 0.4rem;
				min-height: 30px;
				min-width: 30px;
			}

			.region-filter img {
				width: 20px;
				height: 14px;
			}

			/* Stats bar smaller */
			.stats-bar {
				padding: 0.25rem 1rem;
			}

			.stat-item {
				font-size: 0.72rem;
			}

			/* Less top padding since header is shorter */
			.main-content {
				padding-top: 85px;
			}

			/* 2 columns in landscape instead of 1 */
			.grid-container {
				grid-template-columns: repeat(2, 1fr) !important;
				gap: 0.5rem;
			}

			/* Videos shorter so 2 fit on screen without scrolling */
			.video-element {
				aspect-ratio: 16/9;
				max-height: 35vh;
			}

			/* Bigger sidebar in landscape since screen is wider */
			.mobile-sidebar {
				width: 50%;
				max-width: 400px;
				transform: translateX(-120%);
			}
			.mobile-sidebar.active {
				transform: translateX(0);
			}
			/* Custom layout overlay */
			.custom-layout-controls {
				max-height: 90vh;
				width: 80%;
			}

			.channel-picker {
				grid-template-columns: repeat(3, 1fr);
			}
		}

		.custom-layout-btn {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.5rem 1rem;
			background: rgba(255, 255, 255, 0.1);
			border: none;
			border-radius: 8px;
			color: white;
			font-size: 0.9rem;
			cursor: pointer;
			transition: all 0.3s ease;
			white-space: nowrap;
			user-select: none;
		}

		.custom-layout-btn:hover {
			background: rgba(255, 255, 255, 0.2);
		}

		.custom-layout-btn.active {
			background: rgba(79, 70, 229, 0.6);
			box-shadow: 0 0 20px rgba(79, 70, 229, 0.3);
		}
		.region-filter img {
			width: 24px;
			height: 18px;
			border-radius: 2px;
			display: block;
			object-fit: contain;
		}
		.region-filter i {
			font-size: 1.2rem;
		}
		.world-icon {
			width: 22px;
			height: 22px;
			object-fit: contain;
		}
		select, option {
			font-family: Arial, 'Noto Color Emoji', sans-serif;
		}
		
		.custom-dropdown {
			position: relative;
			width: 100%;
		}

		.custom-dropdown-selected {
			width: 100%;
			padding: 0.75rem;
			background: rgba(255, 255, 255, 0.1);
			border: 1px solid rgba(255, 255, 255, 0.2);
			border-radius: 6px;
			color: white;
			font-size: 1rem;
			cursor: pointer;
			text-align: left;
			direction: ltr;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.custom-dropdown-list {
			display: none;
			position: absolute;
			top: 100%;
			left: 0;
			right: 0;
			background: rgba(26, 26, 46, 0.98);
			border: 1px solid rgba(255, 255, 255, 0.2);
			border-radius: 6px;
			z-index: 9999;
			max-height: 300px;
			overflow-y: auto;
			direction: ltr;
			text-align: left;
		}

		.custom-dropdown-list.open {
			display: block;
		}

		.custom-dropdown-item {
			padding: 0.6rem 0.75rem;
			color: white;
			cursor: pointer;
			font-size: 0.9rem;
			direction: ltr;
			text-align: left;
			font-family: Arial, 'Noto Color Emoji', 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif;
		}

		.custom-dropdown-item:hover {
			background: rgba(255,255,255,0.1);
		}

		.custom-dropdown-item.disabled {
			color: #aaa;
			font-style: italic;
			cursor: default;
			font-size: 0.8rem;
			padding: 0.3rem 0.75rem;
		}

		.custom-dropdown-item.separator {
			border-top: 1px solid #444;
			padding: 0;
			margin: 2px 0;
		}

		/* ── AI Sum Button ── */
		.ai-sum-btn {
			width: 100%;
			padding: 0.85rem 1rem;
			background: linear-gradient(135deg, rgba(79,70,229,0.8), rgba(139,92,246,0.8));
			border: 1px solid rgba(139,92,246,0.5);
			border-radius: 10px;
			color: white;
			font-size: 1rem;
			font-weight: 600;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 0.6rem;
			transition: all 0.3s ease;
		}
		.ai-sum-btn:hover {
			background: linear-gradient(135deg, rgba(79,70,229,1), rgba(139,92,246,1));
			transform: translateY(-1px);
			box-shadow: 0 4px 20px rgba(139,92,246,0.4);
		}

		/* ── AI Sum Overlay ── */
		.ai-sum-overlay {
			display: none;
			position: fixed;
			top: 0; left: 0;
			width: 100%; height: 100%;
			background: rgba(0,0,0,0.85);
			z-index: 3000;
			overflow-y: auto;
		}
		.ai-sum-overlay.active { display: block; }

		.ai-sum-panel {
			background: linear-gradient(160deg, #0d0d1a 0%, #111827 100%);
			min-height: 100vh;
			max-width: 900px;
			margin: 0 auto;
			padding: 0 0 3rem 0;
		}

		.ai-sum-header {
			position: sticky;
			top: 0;
			background: rgba(10,10,25,0.97);
			backdrop-filter: blur(12px);
			border-bottom: 1px solid rgba(139,92,246,0.3);
			padding: 1rem 1.5rem;
			display: flex;
			justify-content: space-between;
			align-items: center;
			z-index: 10;
		}
		.ai-sum-title {
			font-size: 1.2rem;
			font-weight: 700;
			color: white;
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}
		.ai-sum-title .gradient-text {
			background: linear-gradient(135deg, #818cf8, #a78bfa);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
		}
		.ai-sum-close {
			background: rgba(255,255,255,0.1);
			border: none;
			color: white;
			font-size: 1.4rem;
			cursor: pointer;
			width: 36px; height: 36px;
			border-radius: 50%;
			display: flex; align-items: center; justify-content: center;
			transition: all 0.2s;
		}
		.ai-sum-close:hover { background: rgba(255,255,255,0.2); }

		.ai-sum-controls {
			padding: 0.75rem 1.5rem;
			display: flex;
			align-items: center;
			gap: 0.75rem;
			flex-wrap: wrap;
			border-bottom: 1px solid rgba(255,255,255,0.06);
		}
		.ai-sum-fetch-btn {
			padding: 0.5rem 1.2rem;
			background: rgba(79,70,229,0.8);
			border: none;
			border-radius: 8px;
			color: white;
			font-size: 0.85rem;
			font-weight: 600;
			cursor: pointer;
			display: flex; align-items: center; gap: 0.5rem;
			transition: all 0.2s;
		}
		.ai-sum-fetch-btn:hover { background: rgba(79,70,229,1); }
		.ai-sum-fetch-btn:disabled { opacity: 0.5; cursor: not-allowed; }

		.gemini-key-input {
			padding: 0.5rem 0.75rem;
			background: rgba(255,255,255,0.07);
			border: 1px solid rgba(255,255,255,0.15);
			border-radius: 8px;
			color: white;
			font-size: 0.82rem;
			width: 240px;
			outline: none;
		}
		.gemini-key-input:focus { border-color: rgba(139,92,246,0.6); }
		.gemini-key-input::placeholder { color: rgba(255,255,255,0.35); }

		.gemini-enhance-btn {
			padding: 0.5rem 1rem;
			background: rgba(16,185,129,0.2);
			border: 1px solid rgba(16,185,129,0.4);
			border-radius: 8px;
			color: #6ee7b7;
			font-size: 0.82rem;
			cursor: pointer;
			display: flex; align-items: center; gap: 0.4rem;
			transition: all 0.2s;
			white-space: nowrap;
		}
		.gemini-enhance-btn:hover { background: rgba(16,185,129,0.35); }
		.gemini-enhance-btn:disabled { opacity: 0.4; cursor: not-allowed; }

		.ai-sum-status {
			font-size: 0.78rem;
			color: rgba(255,255,255,0.45);
			margin-left: auto;
		}

		.ai-sum-loading {
			display: none;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 4rem 2rem;
			gap: 1rem;
			color: rgba(255,255,255,0.6);
			font-size: 0.9rem;
		}
		.ai-sum-loading.active { display: flex; }
		.ai-sum-spinner {
			width: 44px; height: 44px;
			border: 3px solid rgba(139,92,246,0.2);
			border-top: 3px solid #a78bfa;
			border-radius: 50%;
			animation: spin 0.9s linear infinite;
		}
		.ai-sum-progress {
			font-size: 0.78rem;
			color: rgba(139,92,246,0.8);
		}

		.ai-sum-list {
			padding: 1rem 1.5rem;
			display: flex;
			flex-direction: column;
			gap: 0.75rem;
		}

		.story-card {
			background: rgba(255,255,255,0.04);
			border: 1px solid rgba(255,255,255,0.08);
			border-radius: 12px;
			padding: 1rem 1.2rem;
			transition: all 0.2s;
		}
		.story-card:hover {
			background: rgba(255,255,255,0.07);
			border-color: rgba(139,92,246,0.3);
		}
		.story-top {
			display: flex;
			align-items: flex-start;
			gap: 0.75rem;
			margin-bottom: 0.6rem;
		}
		.story-rank {
			font-size: 0.72rem;
			color: rgba(255,255,255,0.3);
			min-width: 22px;
			padding-top: 2px;
		}
		.story-badge {
			padding: 0.2rem 0.6rem;
			border-radius: 20px;
			font-size: 0.7rem;
			font-weight: 700;
			white-space: nowrap;
			flex-shrink: 0;
		}
		.badge-hot    { background: rgba(34,197,94,0.2);   color: #4ade80; border: 1px solid rgba(34,197,94,0.3); }
		.badge-warm   { background: rgba(245,158,11,0.2);  color: #fbbf24; border: 1px solid rgba(245,158,11,0.3); }
		.badge-normal { background: rgba(239,68,68,0.2);   color: #f87171; border: 1px solid rgba(239,68,68,0.3); }
		.story-headline {
			font-size: 0.92rem;
			font-weight: 600;
			color: rgba(255,255,255,0.92);
			line-height: 1.4;
			flex: 1;
		}
		.story-sources {
			display: flex;
			flex-wrap: wrap;
			gap: 0.4rem;
			padding-left: 2rem;
		}
		.source-link {
			display: inline-flex;
			align-items: center;
			gap: 0.4rem;
			padding: 0.2rem 0.6rem;
			background: rgba(255,255,255,0.06);
			border: 1px solid rgba(255,255,255,0.1);
			border-radius: 6px;
			color: rgba(255,255,255,0.65);
			font-size: 0.72rem;
			text-decoration: none;
			transition: all 0.15s;
		}
		.source-link:hover {
			background: rgba(139,92,246,0.2);
			border-color: rgba(139,92,246,0.4);
			color: #c4b5fd;
		}

		.ai-sum-summary-bar {
			display: none;
			padding: 0.6rem 1.5rem;
			background: rgba(139,92,246,0.1);
			border-bottom: 1px solid rgba(139,92,246,0.2);
			font-size: 0.78rem;
			color: rgba(255,255,255,0.5);
			gap: 1.5rem;
			align-items: center;
			flex-wrap: wrap;
		}
		.ai-sum-summary-bar.active { display: flex; }
		.ai-sum-summary-bar strong { color: rgba(139,92,246,0.9); }

		.gemini-badge {
			display: inline-flex;
			align-items: center;
			gap: 0.3rem;
			padding: 0.15rem 0.5rem;
			background: rgba(16,185,129,0.15);
			border: 1px solid rgba(16,185,129,0.3);
			border-radius: 4px;
			font-size: 0.68rem;
			color: #6ee7b7;
		}

		.ai-sum-empty {
			display: none;
			text-align: center;
			padding: 4rem 2rem;
			color: rgba(255,255,255,0.35);
			font-size: 0.9rem;
			flex-direction: column;
			gap: 0.5rem;
			align-items: center;
			justify-content: center;
		}
		.ai-sum-empty.active { display: flex; }

		@media (max-width: 768px) {
			.ai-sum-controls { gap: 0.5rem; }
			.gemini-key-input { width: 100%; }
			.ai-sum-status { margin-left: 0; width: 100%; }
			.ai-sum-list { padding: 0.75rem; }
			.story-sources { padding-left: 0; }
		}

		.story-headline-he {
			font-size: 0.92rem;
			color: rgba(255,255,255,0.55);
			line-height: 1.4;
			margin-top: 0.2rem;
		    margin-bottom: 0.6rem;
			padding-left: 2rem;
			direction: rtl;
			text-align: right;
			font-style: italic;
		}


    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-container">
				<button class="hamburger-btn-main" onclick="openMobileMenu()">
					<i class="fas fa-bars"></i>
				</button>
				<a href="#" class="logo">Hamal Tatzpit</a>
			</div>
            
            <div class="controls">
                <div class="region-filters">
					<label class="region-filter active" id="allFilter" onclick="toggleAll(event)">
						<input type="checkbox" id="allCheckbox" checked>
						<i class="fas fa-check"></i>
					</label>
                    <label class="region-filter active" data-region="arab">
                        <input type="checkbox" id="arabCheckbox" checked>
                        <img src="flags/sa.png" alt="Arab">
                    </label>
                    <label class="region-filter active" data-region="israel">
                        <input type="checkbox" id="israelCheckbox" checked>
                        <img src="flags/il.png" alt="Israel">
                    </label>
                    <label class="region-filter active" data-region="usa">
                        <input type="checkbox" id="usaCheckbox" checked>
                        <img src="flags/us.png" alt="USA">
                    </label>
                    <label class="region-filter active" data-region="iran">
                        <input type="checkbox" id="iranCheckbox" checked>
                        <img src="flags/ir.png" alt="Iran">
                    </label>
                    <label class="region-filter active" data-region="world">
                        <input type="checkbox" id="worldCheckbox" checked>
                        <img src="flags/world.png" alt="World" class="world-icon">
                    </label>
					<button class="custom-layout-btn" onclick="showCustomLayout()">
						<i class="fas fa-pencil"></i>
					</button>
                </div>
                <select class="grid-selector" id="gridSelector">
                    <option value="grid-1xY">1xY</option>
					<option value="grid-2xY">2xY</option>
					<option value="grid-3xY" selected>3xY</option>
					<option value="grid-4xY">4xY</option>
					<option value="grid-5xY">5xY</option>
                </select>
            </div>
        </div>
    </header>

	<div class="custom-layout-overlay" id="customLayoutOverlay" onclick="handleOverlayClick(event)">
		<div class="custom-layout-controls" id="customLayoutControls">
			<div class="custom-layout-header">
				<h3>Select Channels (max 6)</h3>
				<button class="custom-layout-close" onclick="cancelCustomLayout()">×</button>
			</div>
			<div class="channel-picker" id="channelPicker">
				<!-- Channels will be populated by JavaScript -->
			</div>
			<div class="custom-controls">
				<button class="custom-btn" onclick="applyCustomLayout()">Apply Layout</button>
				<button class="custom-btn" onclick="cancelCustomLayout()">Cancel</button>
				<button class="custom-btn" onclick="clearSelection()">Clear All</button>
			</div>
		</div>
	</div>

    <div class="stats-bar">
		<div class="stats-bar-content">
			<div class="stat-item">
				<i class="fas fa-play-circle"></i>
				<span>Active Streams: <span class="stat-value" id="activeStreams">0</span><span style="color: #888;">/</span><span class="stat-value" id="visibleChannels">0</span></span>
			</div>
			<div class="stat-item">
				<i class="fas fa-signal"></i>
				<span>Traffic Saved: <span class="stat-value" id="trafficSaved">High</span></span>
			</div>
			<div class="stat-item">
				<i class="fas fa-chart-line"></i>
				<span>Bandwidth: <span class="stat-value" id="bandwidthUsage">0 Mbps</span></span>
			</div>
		</div>
	</div>

    <main class="main-content">
        <div class="grid-container grid-3xY" id="gridContainer">
            <!-- Arab Channels -->
            <div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Al Manar - Hezbollah FIXED</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video1" muted preload="none" controls></video>
				<!-- <div class="play-overlay" onclick="playVideo('video1', 'https://e2.manar.live:9000/live/tracks-v1a1/mono.m3u8')"> -->
				<div class="play-overlay" onclick="playVideo('video1', 'https://edge.fastpublish.me/live/tracks-v3a1/mono.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Al Arabiya</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video3" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video3', 'https://live.alarabiya.net/alarabiapublish/alarabiya.smil/playlist.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Alhurra NOT WORKING</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video4" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video4', 'https://mbn-ingest-worldsafe.akamaized.net/hls/live/2038900/MBN_Alhurra_Worldsafe_HLS/master_2596.m3u8')">
				<!-- <div class="play-overlay" onclick="playVideo('video4', 'https://mbn-ingest-worldsafe.akamaized.net/hls/live/2038900/MBN_Alhurra_Worldsafe_HLS/master_1628.m3u8')"> -->
				<!-- <div class="play-overlay" onclick="playVideo('video4', 'https://mbn-ingest-worldsafe.akamaized.net/hls/live/2038900/MBN_Alhurra_Worldsafe_HLS/merge.m3u8')"> -->
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Al Jazeera</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video5" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video5', 'https://live-hls-web-aja.getaj.net/AJA/index.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Al Jazeera Mubasher</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video6" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video6', 'https://live-hls-web-ajm.getaj.net/AJM/05.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Al Hadath - Saudi</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video7" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video7', 'https://av.alarabiya.net/alarabiapublish/alhadath.smil/playlist.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Palestine Today</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video8" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video8', 'https://live.paltodaytv.com/paltv/live/playlist.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

			<div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Palestine Mubasher</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video9" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video9', 'https://pbc.furrera.ps/palestinelivehd/index.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>
			
			<div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Palestine Satelite channel</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video10" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video10', 'https://pbc.furrera.ps/palestinehd/index.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Jordan TV</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video11" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video11', 'https://jrtv-live.ercdn.net/jordanhd/jordanhd_1080p.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Voice of Lebanon</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video12" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video12', 'https://svs.itworkscdn.net/vdltvlive/vdltv.smil/playlist.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="arab">
                <div class="video-header">
                    <div class="video-title">Syria TV</div>
                    <div class="country-badge badge-arab">Arab</div>
                </div>
                <video class="video-element" id="video13" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video13', 'https://svs.itworkscdn.net/syriatvlive/syriatv.smil/playlist_dvr.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <!-- Israel Channels -->
            <div class="video-container" data-region="israel">
                <div class="video-header">
                    <div class="video-title">ערוץ 11</div>
                    <div class="country-badge badge-israel">Israel</div>
                </div>
                <video class="video-element" id="video14" muted preload="none" controls></video>
				<div class="play-overlay" onclick="playVideo('video14', 'https://kancdn.medonecdn.net/livehls/oil/kancdn-live/live/kan11/live.livx/playlist.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="israel">
                <div class="video-header">
                    <div class="video-title">ערוץ 12 FIXED</div>
                    <div class="country-badge badge-israel">Israel</div>
                </div>
                <video class="video-element" id="video15" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video15', 'https://mako-streaming.akamaized.net/stream/hls/live/2033791/k12n12wad/index.m3u8?b-in-range=0-1800&hdnea=st%3D1772230974%7Eexp%3D1772231874%7Eacl%3D%2F*%7Ehmac%3D273ee965be2fd8f099d06b2bcf45c3b8beb89659a8209fc2038c0634775c08ce&_uid=W28081e5d5f974edb55d919af4f40a50b0bd&dxseg=25SSfD0q%2CMLT0tmGC%2ClVVh9etP%2CmWPE8VTE%2CmqZmzXw7%2CpCTwtlP9%2Cy79VtRne%2CzDDDMl3T%2Cu0UR9fsv%2C40vtNLUs%2CBGue8q07%2CFZOFrmNp%2Cvbk5sJ97%2CC5B5Rnl9&dxu=bee7081a-40a1-4a11-a996-7f51dcef8f04&user_id=fa6990ab321fd2f97ab41832005638ea&cust_params=interests%3D%26smu%3Daf5821f0-8f69-4bf3-8028-74678801be5c&ppid=af5821f0-8f69-4bf3-8028-74678801be5c')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="israel">
                <div class="video-header">
                    <div class="video-title">ערוץ 13 FIXED</div>
                    <div class="country-badge badge-israel">Israel</div>
                </div>
                <video class="video-element" id="video16" muted preload="none" controls></video>
                <!-- <div class="play-overlay" onclick="playVideo('video16', 'https://d18b0e6mopany4.cloudfront.net/out/v1/1a7c55961dec4c72b51d79e5d9216cff/index.m3u8')"> -->
                <div class="play-overlay" onclick="playVideo('video16', 'https://d18b0e6mopany4.cloudfront.net/out/v1/2f2bc414a3db4698a8e94b89eaf2da2a/index.m3u8')">
				<i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="israel">
                <div class="video-header">
                    <div class="video-title">ערוץ 14</div>
                    <div class="country-badge badge-israel">Israel</div>
                </div>
                <video class="video-element" id="video17" muted preload="none" controls></video>
                <!-- <div class="play-overlay" onclick="playVideo('video17', 'https://ch14-channel14-content.akamaized.net/hls/live/2104807/CH14_CHANNEL14/2/streamPlaylist.m3u8')"> -->
				<div class="play-overlay" onclick="playVideo('video17', 'https://r.il.cdn-redge.media/livehls/oil/ch14/live/ch14/live.livx/playlist.m3u8')">
					<i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>	
				
            <div class="video-container" data-region="israel">
                <div class="video-header">
                    <div class="video-title">i24News FIXED</div>
                    <div class="country-badge badge-israel">Israel</div>
                </div>
                <video class="video-element" id="video18" muted preload="none" controls></video>
                <!-- <div class="play-overlay" onclick="playVideo('video18', 'https://bcovlive-a.akamaihd.net/6e3dd61ac4c34d6f8fb9698b565b9f50/eu-central-1/5377161796001/playlist-all_dvr.m3u8')"> -->
				<div class="play-overlay" onclick="playVideo('video18', 'https://fastly.live.brightcove.com/6386790215112/eu-central-1/5377161796001/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJob3N0IjoiZXJmajYzLmVncmVzcy53YzQ3bTEiLCJhY2NvdW50X2lkIjoiNTM3NzE2MTc5NjAwMSIsImVobiI6ImZhc3RseS5saXZlLmJyaWdodGNvdmUuY29tIiwiaXNzIjoiYmxpdmUtcGxheWJhY2stc291cmNlLWFwaSIsInN1YiI6InBhdGhtYXB0b2tlbiIsImF1ZCI6WyI1Mzc3MTYxNzk2MDAxIl0sImp0aSI6IjYzODY3OTAyMTUxMTIifQ.8ZawImK7DfcrrXeAT2OVZ62qQJrJiBaoc7Y1DNNq1bg/playlist-hls.m3u8?__nn__=5476555825001&hdnea=st=1767895200~exp=1767898800~acl=/6386790215112/eu-central-1/5377161796001/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJob3N0IjoiZXJmajYzLmVncmVzcy53YzQ3bTEiLCJhY2NvdW50X2lkIjoiNTM3NzE2MTc5NjAwMSIsImVobiI6ImZhc3RseS5saXZlLmJyaWdodGNvdmUuY29tIiwiaXNzIjoiYmxpdmUtcGxheWJhY2stc291cmNlLWFwaSIsInN1YiI6InBhdGhtYXB0b2tlbiIsImF1ZCI6WyI1Mzc3MTYxNzk2MDAxIl0sImp0aSI6IjYzODY3OTAyMTUxMTIifQ.8ZawImK7DfcrrXeAT2OVZ62qQJrJiBaoc7Y1DNNq1bg/*~hmac=59be9c55159d8b6167ec5d5a7528df6b7bf144a4d8fe71dd486a93e5032f20a2')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <!-- USA Channels -->
            <div class="video-container" data-region="usa">
                <div class="video-header">
                    <div class="video-title">CNN FIXED</div>
                    <div class="country-badge badge-usa">USA</div>
                </div>
                <video class="video-element" id="video19" muted preload="none" controls></video>
                <!-- <div class="play-overlay" onclick="playVideo('video19', 'https://cnn-cnninternational-1-eu.rakuten.wurl.tv/playlist.m3u8')"> -->
				<!-- <div class="play-overlay" onclick="playVideo('video19', 'https://d3bp6dwmpbdajl.cloudfront.net/v1/master/3722c60a815c199d9c0ef36c5b73da68a62b09d1/cc-ury0meh5m4nzm/index.m3u8')"> -->
                <div class="play-overlay" onclick="playVideo('video19', 'https://turnerlive.warnermediacdn.com/hls/live/586497/cnngo/cnni/VIDEO_0_3564000.m3u8')">
					<i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="usa">
                <div class="video-header">
                    <div class="video-title">CNN 2</div>
                    <div class="country-badge badge-usa">USA</div>
                </div>
                <video class="video-element" id="video20" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video20', 'https://turnerlive.warnermediacdn.com/hls/live/586495/cnngo/cnn_slate/VIDEO_4_1064000.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>
			
            <div class="video-container" data-region="usa">
                <div class="video-header">
                    <div class="video-title">FOX News</div>
                    <div class="country-badge badge-usa">USA</div>
                </div>
                <video class="video-element" id="video21" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video21', 'https://247preview.foxnews.com/hls/live/2020027/fncv3preview/primary.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="usa">
                <div class="video-header">
                    <div class="video-title">LiveNOW from FOX FIXED</div>
                    <div class="country-badge badge-usa">USA</div>
                </div>
                <video class="video-element" id="video22" muted preload="none" controls></video>
                <!-- <div class="play-overlay" onclick="playVideo('video22', 'https://lnc-fox-live-now.tubi.video/index.m3u8')"> -->
				<div class="play-overlay" onclick="playVideo('video22', 'https://cdn-uw2-prod.tsv2.amagi.tv/linear/amg00488-foxdigital-livenowbyfox-lgus/playlist.m3u8')">
				<!-- <div class="play-overlay" onclick="playVideo('video22', 'https://www.youtube.com/watch?v=TKdyfoEEWYw')"> -->
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="usa">
                <div class="video-header">
                    <div class="video-title">NBC News FIXED</div>
                    <div class="country-badge badge-usa">USA</div>
                </div>
                <video class="video-element" id="video23" muted preload="none" controls></video>
                <!-- <div class="play-overlay" onclick="playVideo('video23', 'https://lnc-nbc-news-now.tubi.video/master.m3u8')"> -->
				<div class="play-overlay" onclick="playVideo('video23', 'https://d4ybyqrhce41r.cloudfront.net/v1/master/3fec3e5cac39a52b2132f9c66c83dae043dc17d4/prod-xumo-linear-nbcu-hlsv3/master.m3u8?ads.channelId=99991247')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="usa">
                <div class="video-header">
                    <div class="video-title">ABC News FIXED</div>
                    <div class="country-badge badge-usa">USA</div>
                </div>
                <video class="video-element" id="video24" muted preload="none" controls></video>
                <!-- <div class="play-overlay" onclick="playVideo('video24', 'https://lnc-abc-news.tubi.video/index.m3u8')"> -->
                <div class="play-overlay" onclick="playVideo('video24', 'https://live-manifest.production-public.tubi.io/live/14e4f5f2-9787-4c49-8554-f2ad109764a7/playlist.m3u8')">
					<i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="usa">
                <div class="video-header">
                    <div class="video-title">CBS News</div>
                    <div class="country-badge badge-usa">USA</div>
                </div>
                <video class="video-element" id="video25" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video25', 'https://cbsn-us.cbsnstream.cbsnews.com/out/v1/55a8648e8f134e82a470f83d562deeca/master.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="usa">
                <div class="video-header">
                    <div class="video-title">News12 New York FIXED</div>
                    <div class="country-badge badge-usa">USA</div>
                </div>
                <video class="video-element" id="video26" muted preload="none" controls></video>
                <!-- <div class="play-overlay" onclick="playVideo('video26', 'https://lnc-news12.tubi.video/index.m3u8')"> -->
				<div class="play-overlay" onclick="playVideo('video26', 'https://wurlnews12ny.global.transmit.live/hls/68c48577268ca4398b084116/v1/alticeusanewsinc_news12newyork_1/lg_us/latest/main/hls/playlist.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <!-- Iran Channels -->
            <div class="video-container" data-region="iran">
                <div class="video-header">
                    <div class="video-title">Al Mayadeen FIXED</div>
                    <div class="country-badge badge-iran">Iran</div>
                </div>
                <video class="video-element" id="video27" muted preload="none" controls></video>
                <!-- <div class="play-overlay" onclick="playVideo('video27', 'https://mdnlv.cdn.octivid.com/almdn/smil:mpegts.stream.smil/chunklist_b2000000_t64NDgwcA==.m3u8')"> -->
				<div class="play-overlay" onclick="playVideo('video27', 'https://mdnlv.cdn.octivid.com/almdn/smil:mpegts.stream.smil/chunklist_b2000000.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="iran">
                <div class="video-header">
                    <div class="video-title">Iran-e-Farda TV</div>
                    <div class="country-badge badge-iran">Iran</div>
                </div>
                <video class="video-element" id="video28" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video28', 'https://hls.iranfarda.live/hls/stream.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="iran">
                <div class="video-header">
                    <div class="video-title">Simaye Azadi NOT WORKING</div>
                    <div class="country-badge badge-iran">Iran</div>
                </div>
                <video class="video-element" id="video29" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video29', 'https://simaytv.akamaized.net/hls/live/2043550/simayhls/index.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="iran">
                <div class="video-header">
                    <div class="video-title">Iran International</div>
                    <div class="country-badge badge-iran">Iran</div>
                </div>
                <video class="video-element" id="video30" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video30', 'https://dev-live.livetvstream.co.uk/LS-63503-4/index.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="iran">
                <div class="video-header">
                    <div class="video-title">IRINN NOT WORKING</div>
                    <div class="country-badge badge-iran">Iran</div>
                </div>
                <video class="video-element" id="video31" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video31', 'https://live.aionet.ir/hls/irinn/irinn.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="iran">
                <div class="video-header">
                    <div class="video-title">SNN NOT WORKING</div>
                    <div class="country-badge badge-iran">Iran</div>
                </div>
                <video class="video-element" id="video32" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video32', 'https://live2.snn.ir/hls/snn0_low/index.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="iran">
                <div class="video-header">
                    <div class="video-title">Press TV</div>
                    <div class="country-badge badge-iran">Iran</div>
                </div>
                <video class="video-element" id="video33" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video33', 'https://live.presstv.ir/hls/presstv_5_482/index.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <!-- World Channels -->
            <div class="video-container" data-region="world">
                <div class="video-header">
                    <div class="video-title">BBC World</div>
                    <div class="country-badge badge-world">World</div>
                </div>
                <video class="video-element" id="video34" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video34', 'https://vs-hls-push-ww-live.akamaized.net/x=4/i=urn:bbc:pips:service:bbc_news_channel_hd/t=3840/v=pv14/b=5070016/main.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="world">
                <div class="video-header">
                    <div class="video-title">Sky News UK</div>
                    <div class="country-badge badge-world">World</div>
                </div>
                <video class="video-element" id="video35" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video35', 'https://linear417-gb-hls3-prd-ak.cdn.skycdp.com/100e/Content/HLS_004_1080_30/Live/channel(skynews)/index_1080.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="world">
                <div class="video-header">
                    <div class="video-title">Global News Canada</div>
                    <div class="country-badge badge-world">World</div>
                </div>
                <video class="video-element" id="video36" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video36', 'https://live.corusdigitaldev.com/groupd/live/49a91e7f-1023-430f-8d66-561055f3d0f7/live.isml/master.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>

            <div class="video-container" data-region="world">
                <div class="video-header">
                    <div class="video-title">RT News</div>
                    <div class="country-badge badge-world">World</div>
                </div>
                <video class="video-element" id="video37" muted preload="none" controls></video>
                <div class="play-overlay" onclick="playVideo('video37', 'https://rt-glb.rttv.com/live/rtnews/playlist.m3u8')">
                    <i class="fas fa-play"></i>
                </div>
                <div class="loading-indicator"><div class="spinner"></div></div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        let activeStreams = new Set();
        let loadedStreams = new Map();
        let bandwidthMonitor = {
            startTime: Date.now(),
            totalBytes: 0,
            currentBandwidth: 0
        };

		function adjustStatBarPosition() {
			const header = document.querySelector('.header');
			const statsBar = document.querySelector('.stats-bar');
			const mainContent = document.querySelector('.main-content');
			
			const headerHeight = header.getBoundingClientRect().height;
			statsBar.style.top = headerHeight + 'px';

			// Read stats bar height AFTER setting its top position
			setTimeout(() => {
				const statsBarHeight = statsBar.getBoundingClientRect().height;
				mainContent.style.paddingTop = (headerHeight + statsBarHeight + 10) + 'px';
			}, 10);
		}
		window.addEventListener('resize', () => {
			clearTimeout(window.resizeTimer);
			window.resizeTimer = setTimeout(adjustStatBarPosition, 50);
		});
		
		function toggleAll(event) {
			event.preventDefault();
			const allCheckbox = document.getElementById('allCheckbox');
			const allFilter = document.getElementById('allFilter');
			const isChecked = !allCheckbox.checked;

			allCheckbox.checked = isChecked;
			allFilter.classList.toggle('active', isChecked);

			// Set all region filters to match
			document.querySelectorAll('.region-filter:not(#allFilter)').forEach(filter => {
				filter.classList.toggle('active', isChecked);
				filter.querySelector('input').checked = isChecked;
			});

			// Reset custom layout
			document.querySelector('.custom-layout-btn').classList.remove('active');
			customSelectedChannels.clear();
			document.querySelectorAll('.video-container').forEach(c => c.classList.remove('hidden'));
			updateCustomControls();
			
			filterVideos();
			updateStats();
		}

        // Generate poster image for video containers
        function generatePosterImage(videoId, region) {
            const canvas = document.createElement('canvas');
            canvas.width = 640;
            canvas.height = 360;
            const ctx = canvas.getContext('2d');
            
            // Create solid dark background instead of colored gradient
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, 640, 360);
            
            // Add region indicator
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 320, 640, 40);
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`${region.toUpperCase()} NEWS`, 320, 345);
            
            // Add play icon
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.moveTo(290, 160);
            ctx.lineTo(290, 200);
            ctx.lineTo(320, 180);
            ctx.closePath();
            ctx.fill();
            
            return canvas.toDataURL();
        }

		// Generate red X image for unavailable streams
		function generateUnavailableImage() {
			const canvas = document.createElement('canvas');
			canvas.width = 640;
			canvas.height = 360;
			const ctx = canvas.getContext('2d');
			
			// Dark background
			ctx.fillStyle = '#1a1a1a';
			ctx.fillRect(0, 0, 640, 360);
			
			// Red X
			ctx.strokeStyle = '#ff0000';
			ctx.lineWidth = 8;
			ctx.lineCap = 'round';
			
			// Draw X (two diagonal lines)
			ctx.beginPath();
			// Top-left to bottom-right
			ctx.moveTo(200, 120);
			ctx.lineTo(440, 240);
			// Top-right to bottom-left
			ctx.moveTo(440, 120);
			ctx.lineTo(200, 240);
			ctx.stroke();
			
			// "UNAVAILABLE" text
			ctx.fillStyle = '#ff0000';
			ctx.font = 'bold 24px Arial';
			ctx.textAlign = 'center';
			ctx.fillText('STREAM UNAVAILABLE', 320, 290);
			
			return canvas.toDataURL();
		}

        // Initialize the application
		document.addEventListener('DOMContentLoaded', function() {
			initializePosters();
			initializeFilters();
			initializeGridSelector();
			initializeBandwidthMonitoring();
			const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
			if (!isIOS) {
				autoLoadAllVideos();
			}
			updateStats();
			setTimeout(adjustStatBarPosition, 50);
			
			// Double-click to fullscreen
			document.querySelectorAll('video').forEach(video => {
				video.addEventListener('dblclick', function() {
					toggleFullscreen(this);
				});
			});

			// Observe all video containers for performance
			document.querySelectorAll('.video-container').forEach(container => {
				observer.observe(container);
			});

		});

        // Initialize poster images for all videos
        function initializePosters() {
            const videoContainers = document.querySelectorAll('.video-container');
            videoContainers.forEach(container => {
                const video = container.querySelector('video');
                const region = container.getAttribute('data-region');
                const posterUrl = generatePosterImage(video.id, region);
                video.poster = posterUrl;
            });
        }

		// Auto-load all videos and pause them to show first frame
		function autoLoadAllVideos() {
			const MAX_CONCURRENT_PREVIEWS = 6; // 6 x 2.5 Mbps = 15 Mbps cap
			let activePreviewCount = 0;
			const queue = [];

			document.querySelectorAll('.video-container').forEach(container => {
				const video = container.querySelector('video');
				const playOverlay = container.querySelector('.play-overlay');
				const urlMatch = playOverlay.getAttribute('onclick').match(/'([^']+)'/g);
				if (urlMatch && urlMatch[1]) {
					queue.push({ videoId: video.id, streamUrl: urlMatch[1].replace(/'/g, '') });
				}
			});

			function loadNext() {
				while (activePreviewCount < MAX_CONCURRENT_PREVIEWS && queue.length > 0) {
					const { videoId, streamUrl } = queue.shift();
					activePreviewCount++;
					loadVideoForPreview(videoId, streamUrl, () => {
						activePreviewCount--;
						loadNext();
					});
				}
			}

			loadNext();
		}

		// Load video just to get first frame, then pause
		function loadVideoForPreview(videoId, streamUrl, onComplete) {
			let completed = false;
			const video = document.getElementById(videoId);
			const videoContainer = video.closest('.video-container');
			
			// Track preview loading for bandwidth calculation
			activeStreams.add(videoId + '_preview');
			updateStats();
			
			if (Hls.isSupported()) {
				const hls = new Hls({
					enableWorker: false,
					lowLatencyMode: false,
					backBufferLength: 1,
					maxBufferLength: 3
				});
				
				hls.loadSource(streamUrl);
				hls.attachMedia(video);
				
				// Wait for first frame to be ready
				video.addEventListener('loadeddata', function() {
					video.play().then(() => {
						// Wait a moment for frame to display
						setTimeout(() => {
							// Capture the current frame as canvas image
							const canvas = document.createElement('canvas');
							canvas.width = video.videoWidth || 640;
							canvas.height = video.videoHeight || 360;
							const ctx = canvas.getContext('2d');
							
							try {
								// Draw current video frame to canvas
								ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
								
								// Convert to poster image
								const posterUrl = canvas.toDataURL('image/jpeg', 0.8);
								
								// Pause and destroy HLS
								video.pause();
								hls.destroy();
								
								// Set the captured frame as poster
								video.poster = posterUrl;
								video.src = '';
								video.load();
								
							} catch (error) {
								console.log('Could not capture frame for', videoId, error);
								// Fallback: just pause and destroy
								video.pause();
								hls.destroy();
							}
							
							// Remove from active streams
							completed = true;
							activeStreams.delete(videoId + '_preview');
							updateStats();
							if (onComplete) onComplete();
							
						}, 1000); // Wait 1 second for stable frame
					}).catch(() => {
						completed = true;
						// Set red X image as poster
						const unavailableImage = generateUnavailableImage();
						video.poster = unavailableImage;
						video.src = '';
						video.load();
						
						// Remove controls and play overlay
						video.removeAttribute('controls');
						const playOverlay = videoContainer.querySelector('.play-overlay');
						if (playOverlay) {
							playOverlay.style.display = 'none';
						}
						
						// Mark container as unavailable
						videoContainer.classList.add('stream-unavailable');
						
						hls.destroy();
						activeStreams.delete(videoId + '_preview');
						updateStats();
						if (onComplete) onComplete();
});
				}, { once: true });
				
				hls.on(Hls.Events.ERROR, function(event, data) {
					if (completed) return;
					completed = true;
					console.log('Preview load failed for', videoId);
					
					// Set red X image as poster
					const unavailableImage = generateUnavailableImage();
					video.poster = unavailableImage;
					video.src = '';
					video.load();
					
					// Remove controls and play overlay
					video.removeAttribute('controls');
					const playOverlay = videoContainer.querySelector('.play-overlay');
					if (playOverlay) {
						playOverlay.style.display = 'none';
					}
					
					// Mark container as unavailable
					videoContainer.classList.add('stream-unavailable');
					
					hls.destroy();
					activeStreams.delete(videoId + '_preview');
					updateStats();
					if (onComplete) onComplete();
				});
			}
		}

        // Initialize bandwidth monitoring
        function initializeBandwidthMonitoring() {
            setInterval(updateBandwidthUsage, 1000);
        }

        // Update bandwidth usage display
        function updateBandwidthUsage() {
			let totalBps = 0;

			loadedStreams.forEach((hls, videoId) => {
				if (videoId.endsWith('_preview')) return;
				if (!activeStreams.has(videoId)) return;

				if (hls === true) {
					// Native HLS (Safari) — read bitrate from video element
					const video = document.getElementById(videoId);
					if (video && video.webkitVideoDecodedByteCount !== undefined) {
						// Rough estimate from decoded bytes if available
						totalBps += 2_500_000; // fallback: 2.5 Mbps for native
					} else {
						totalBps += 2_500_000; // fallback: 2.5 Mbps
					}
					return;
				}

				if (!hls || !hls.levels) return;

				// Try current level bitrate first
				const level = hls.levels[hls.currentLevel];
				if (level && level.bitrate) {
					totalBps += level.bitrate;
					return;
				}

				// Fallback: if currentLevel not set yet, use lowest available level
				const fallbackLevel = hls.levels.find(l => l.bitrate > 0);
				if (fallbackLevel) {
					totalBps += fallbackLevel.bitrate;
					return;
				}

				// Last resort: use HLS.js bandwidth estimate divided by active stream count
				if (hls.bandwidthEstimate) {
					const realCount = Array.from(activeStreams).filter(id => !id.endsWith('_preview')).length;
					totalBps += hls.bandwidthEstimate / (realCount || 1);
				}
			});

			const totalMbps = totalBps / 1_000_000;
			const bandwidthElement = document.getElementById('bandwidthUsage');

			if (totalMbps > 0) {
				bandwidthElement.textContent = `${totalMbps.toFixed(1)} Mbps`;
				bandwidthElement.style.color = totalMbps >= 15 ? '#ef4444' : '#4f46e5';
			} else {
				bandwidthElement.textContent = '0 Mbps';
				bandwidthElement.style.color = '#22c55e';
			}
		}

        // Initialize region filters
        function initializeFilters() {
            const regionFilters = document.querySelectorAll('.region-filter:not(#allFilter)');
            
            regionFilters.forEach(filter => {
                filter.addEventListener('click', function() {
					const checkbox = this.querySelector('input');
					const isChecked = !checkbox.checked;
					
					checkbox.checked = isChecked;
					this.classList.toggle('active', isChecked);

					document.querySelector('.custom-layout-btn').classList.remove('active');
					customSelectedChannels.clear();
					document.querySelectorAll('.video-container').forEach(c => c.classList.remove('hidden'));
					updateCustomControls();

					// Sync All button — active only if all region filters are checked
					const allChecked = Array.from(document.querySelectorAll('.region-filter:not(#allFilter) input')).every(cb => cb.checked);
					document.getElementById('allCheckbox').checked = allChecked;
					document.getElementById('allFilter').classList.toggle('active', allChecked);

					filterVideos();
					updateStats();
				});
            });
        }

        // Initialize grid selector
        function initializeGridSelector() {
            const gridSelector = document.getElementById('gridSelector');
            gridSelector.addEventListener('change', function() {
                changeGrid(this.value);
            });
            updateGridOptionsForOrientation();
            window.addEventListener('resize', updateGridOptionsForOrientation);
            window.addEventListener('orientationchange', updateGridOptionsForOrientation);
        }

        function updateGridOptionsForOrientation() {
            const selector = document.getElementById('gridSelector');
            
            // Use screen.orientation if available, fallback to dimensions
            let isLandscapeMobile;
            if (screen.orientation) {
                const angle = screen.orientation.angle;
                const type = screen.orientation.type;
                const isLandscape = type.includes('landscape') || angle === 90 || angle === 270;
                const isSmallScreen = Math.min(screen.width, screen.height) <= 900;
                isLandscapeMobile = isLandscape && isSmallScreen;
            } else {
                isLandscapeMobile = window.innerHeight < window.innerWidth && window.innerWidth <= 900;
            }

            if (isLandscapeMobile) {
                selector.innerHTML = `
                    <option value="grid-2xY">2xY</option>
                    <option value="grid-3xY">3xY</option>
                `;
                changeGrid('grid-2xY');
            } else {
                selector.innerHTML = `
                    <option value="grid-1xY">1xY</option>
                    <option value="grid-2xY">2xY</option>
                    <option value="grid-3xY" selected>3xY</option>
                    <option value="grid-4xY">4xY</option>
                    <option value="grid-5xY">5xY</option>
                `;
                changeGrid('grid-3xY');
            }
        }

		// Show custom layout picker
		function showCustomLayout() {
			initializeCustomLayout();
			document.getElementById('customLayoutOverlay').classList.add('active');
			document.querySelector('.custom-layout-btn').classList.add('active');
		}

        // Play video function - only loads when clicked
		function playVideo(videoId, streamUrl) {
			const videoContainer = document.querySelector(`#${videoId}`).closest('.video-container');
			const video = document.getElementById(videoId);
			const loadingIndicator = videoContainer.querySelector('.loading-indicator');

			// Show loading indicator
			loadingIndicator.style.display = 'block';

			// Check if stream is already loaded
			if (loadedStreams.has(videoId)) {
				// Still enforce limit even for previously loaded streams
				const realActiveStreams = Array.from(activeStreams).filter(id => !id.endsWith('_preview'));
				if (realActiveStreams.length >= 6 && !activeStreams.has(videoId)) {
					loadingIndicator.style.display = 'none';
					showErrorMessage(videoContainer, 'Bandwidth limit reached (6 streams / 15 Mbps). Stop a stream first.');
					return;
				}
				video.play();
				video.classList.add('playing');
				videoContainer.classList.add('playing');
				activeStreams.add(videoId);
				loadingIndicator.style.display = 'none';
				updateStats();
				return;
			}

			// Enforce limit for new streams
			const realActiveStreams = Array.from(activeStreams).filter(id => !id.endsWith('_preview'));
			if (realActiveStreams.length >= 6 && !activeStreams.has(videoId)) {
				loadingIndicator.style.display = 'none';
				showErrorMessage(videoContainer, 'Bandwidth limit reached (6 streams / 15 Mbps). Stop a stream first.');
				return;
			}

			// Load stream
			if (Hls.isSupported()) {
				const hls = new Hls({
					enableWorker: false,
					lowLatencyMode: true,
					backBufferLength: 30
				});
				
				hls.loadSource(streamUrl);
				hls.attachMedia(video);
				
				hls.on(Hls.Events.MANIFEST_PARSED, function() {
					loadingIndicator.style.display = 'none';
					video.classList.add('playing');
					videoContainer.classList.add('playing');
					activeStreams.add(videoId);
					loadedStreams.set(videoId, hls);
					
					// ADD THESE LINES - Track play/pause events for bandwidth
					video.addEventListener('play', function() {
						const realActiveStreams = Array.from(activeStreams).filter(id => !id.endsWith('_preview'));
						if (realActiveStreams.length >= 6 && !activeStreams.has(videoId)) {
							video.pause();
							showErrorMessage(videoContainer, 'Bandwidth limit reached (6 streams / 15 Mbps). Stop a stream first.');
							return;
						}
						activeStreams.add(videoId);
						updateStats();
					});
					
					video.addEventListener('pause', function() {
						activeStreams.delete(videoId);
						updateStats();
					});
					
					video.play();
					updateStats();
				});
				
				hls.on(Hls.Events.ERROR, function(event, data) {
					console.error('HLS Error:', data);
					loadingIndicator.style.display = 'none';
					showErrorMessage(videoContainer, 'Stream unavailable');
				});
				
			} else if (video.canPlayType('application/vnd.apple.mpegurl')) {
				video.src = streamUrl;
				video.addEventListener('canplay', function() {
					loadingIndicator.style.display = 'none';
					video.classList.add('playing');
					videoContainer.classList.add('playing');
					activeStreams.add(videoId);
					loadedStreams.set(videoId, true);
					
					// ADD THESE LINES - Track play/pause events for bandwidth
					video.addEventListener('play', function() {
						const realActiveStreams = Array.from(activeStreams).filter(id => !id.endsWith('_preview'));
						if (realActiveStreams.length >= 6 && !activeStreams.has(videoId)) {
							video.pause();
							showErrorMessage(videoContainer, 'Bandwidth limit reached (6 streams / 15 Mbps). Stop a stream first.');
							return;
						}
						activeStreams.add(videoId);
						updateStats();
					});
					
					video.addEventListener('pause', function() {
						activeStreams.delete(videoId);
						updateStats();
					});
					
					video.play();
					updateStats();
				});
			}
		}

        // Stop video and free resources
        function stopVideo(videoId) {
            const video = document.getElementById(videoId);
            const videoContainer = video.closest('.video-container');
            
            video.pause();
            video.currentTime = 0;
            
            // Destroy HLS instance if exists
            if (loadedStreams.has(videoId) && loadedStreams.get(videoId) !== true) {
                const hls = loadedStreams.get(videoId);
                hls.destroy();
            }
            
            loadedStreams.delete(videoId);
            activeStreams.delete(videoId);
            videoContainer.classList.remove('playing');
            
            updateStats();
        }

        // Show error message
        function showErrorMessage(container, message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(239, 68, 68, 0.9);
                color: white;
                padding: 1rem;
                border-radius: 8px;
                font-size: 0.9rem;
                z-index: 20;
            `;
            errorDiv.textContent = message;
            container.appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 3000);
        }

        // Filter videos based on region selection
        function filterVideos() {
            const arabChecked = document.getElementById('arabCheckbox').checked;
            const israelChecked = document.getElementById('israelCheckbox').checked;
            const usaChecked = document.getElementById('usaCheckbox').checked;
            const iranChecked = document.getElementById('iranCheckbox').checked;
            const worldChecked = document.getElementById('worldCheckbox').checked;
            
            const videoContainers = document.querySelectorAll('.video-container');
            
            videoContainers.forEach(container => {
                const region = container.getAttribute('data-region');
                let shouldShow = false;
                
                switch(region) {
                    case 'arab':
                        shouldShow = arabChecked;
                        break;
                    case 'israel':
                        shouldShow = israelChecked;
                        break;
                    case 'usa':
                        shouldShow = usaChecked;
                        break;
                    case 'iran':
                        shouldShow = iranChecked;
                        break;
                    case 'world':
                        shouldShow = worldChecked;
                        break;
                }
                
                if (shouldShow) {
                    container.classList.remove('hidden');
                } else {
                    container.classList.add('hidden');
                    
                    // Stop video if it's playing and region is hidden
                    const video = container.querySelector('video');
                    if (video && activeStreams.has(video.id)) {
                        stopVideo(video.id);
                    }
                }
            });
        }

        // Change grid layout
        function changeGrid(gridClass) {
            const gridContainer = document.getElementById('gridContainer');
            
            // Remove all grid classes
			gridContainer.classList.remove('grid-1xY', 'grid-2xY', 'grid-3xY', 'grid-4xY', 'grid-5xY');
            
            // Add new grid class
            gridContainer.classList.add(gridClass);
        }

        // Update statistics
        function updateStats() {
            const visibleContainers = document.querySelectorAll('.video-container:not(.hidden)');
            const activeStreamCount = Array.from(activeStreams).filter(id => !id.endsWith('_preview')).length;
            const visibleChannelCount = visibleContainers.length;
            
            document.getElementById('activeStreams').textContent = activeStreamCount;
			document.getElementById('visibleChannels').textContent = visibleChannelCount;
            
            // Calculate traffic savings
            const totalChannels = document.querySelectorAll('.video-container').length;
            const inactiveChannels = totalChannels - activeStreamCount;
            const trafficSavedPercent = Math.round((inactiveChannels / totalChannels) * 100);
            
            document.getElementById('trafficSaved').textContent = `${trafficSavedPercent}%`;
            
            // Update bandwidth monitoring
            updateBandwidthUsage();
        }

		// Custom layout functionality
		let customSelectedChannels = new Set();

		// Initialize custom layout controls
		function initializeCustomLayout() {
			const channelPicker = document.getElementById('channelPicker');
			const videoContainers = document.querySelectorAll('.video-container');
			
			channelPicker.innerHTML = '';
			
			videoContainers.forEach(container => {
				const video = container.querySelector('video');
				const title = container.querySelector('.video-title').textContent;
				const region = container.getAttribute('data-region');
				const badge = container.querySelector('.country-badge');
				
				const isSelected = customSelectedChannels.has(video.id);
				const channelOption = document.createElement('div');
				channelOption.className = 'channel-option' + (isSelected ? ' selected' : '');
				channelOption.innerHTML = `
					<input type="checkbox" id="custom_${video.id}" value="${video.id}" ${isSelected ? 'checked' : ''}>
					<span class="country-badge ${badge.className.split(' ')[1]}">${region.toUpperCase()}</span>
					<span>${title}</span>
				`;
				
				channelOption.addEventListener('click', function(e) {
					if (e.target.type !== 'checkbox') {
						const checkbox = this.querySelector('input');
						checkbox.checked = !checkbox.checked;
					}
					toggleChannelSelection(video.id, this);
				});
				
				channelPicker.appendChild(channelOption);
			});
		}

		// Toggle channel selection
		function toggleChannelSelection(videoId, optionElement) {
			const checkbox = optionElement.querySelector('input');
			
			if (checkbox.checked) {
				if (customSelectedChannels.size < 6) {
					customSelectedChannels.add(videoId);
					optionElement.classList.add('selected');
				} else {
					checkbox.checked = false;
					alert('Maximum 6 channels allowed');
				}
			} else {
				customSelectedChannels.delete(videoId);
				optionElement.classList.remove('selected');
			}
			
			updateCustomControls();
		}

		// Update custom controls state
		function updateCustomControls() {
			const applyBtn = document.querySelector('.custom-controls .custom-btn');
			applyBtn.textContent = `Apply Layout (${customSelectedChannels.size}/6)`;
			applyBtn.disabled = customSelectedChannels.size === 0;
		}

		// Apply custom layout
		function applyCustomLayout() {
			if (customSelectedChannels.size === 0) return;
			
			const allContainers = document.querySelectorAll('.video-container');
			
			// Hide all containers first
			allContainers.forEach(container => {
				container.classList.add('hidden');
			});
			
			// Show only selected containers
			customSelectedChannels.forEach(videoId => {
				const container = document.getElementById(videoId).closest('.video-container');
				container.classList.remove('hidden');
			});
			
			// Set appropriate grid based on selection count
			const gridContainer = document.getElementById('gridContainer');
			gridContainer.classList.remove('grid-1xY', 'grid-2xY', 'grid-3xY', 'grid-4xY', 'grid-5xY');
			
			if (customSelectedChannels.size === 1) {
				gridContainer.classList.add('grid-1xY');
			} else if (customSelectedChannels.size <= 4) {
				gridContainer.classList.add('grid-2xY');
			} else {
				gridContainer.classList.add('grid-3xY');
			}
			
			document.getElementById('customLayoutOverlay').classList.remove('active');
			// Keep button purple — custom layout is still active
			// Deactivate all region filter buttons
			document.querySelectorAll('.region-filter').forEach(filter => {
				filter.classList.remove('active');
				filter.querySelector('input').checked = false;
			});
			document.getElementById('allCheckbox').checked = false;
			document.getElementById('allFilter').classList.remove('active');
			
			updateStats();
		}

		// Cancel custom layout
		function cancelCustomLayout() {
			document.getElementById('customLayoutOverlay').classList.remove('active');
			// Only deactivate button if user hasn't applied a custom layout
			if (customSelectedChannels.size === 0) {
				document.querySelector('.custom-layout-btn').classList.remove('active');
			}
		}

		// Clear all selections
		function clearSelection() {
			customSelectedChannels.clear();
			const options = document.querySelectorAll('.channel-option');
			options.forEach(option => {
				option.classList.remove('selected');
				option.querySelector('input').checked = false;
			});
			updateCustomControls();
		}

		function handleOverlayClick(event) {
			if (event.target === document.getElementById('customLayoutOverlay')) {
				cancelCustomLayout();
			}
		}

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Press 'S' to stop all videos
            if (event.key.toLowerCase() === 's' && !event.target.matches('input')) {
                event.preventDefault();
                stopAllVideos();
            }
            
            // Press 'F' to toggle fullscreen on focused video
            if (event.key.toLowerCase() === 'f' && !event.target.matches('input')) {
                event.preventDefault();
                const focusedVideo = document.querySelector('video:focus');
                if (focusedVideo) {
                    toggleFullscreen(focusedVideo);
                }
            }
        });

        // Stop all active videos
        function stopAllVideos() {
			const activeVideoIds = Array.from(activeStreams).filter(id => !id.endsWith('_preview'));
			activeVideoIds.forEach(videoId => stopVideo(videoId));
		}

        // Toggle fullscreen for video
        function toggleFullscreen(video) {
            if (!document.fullscreenElement) {
                video.requestFullscreen().catch(err => {
                    console.error('Error attempting to enable fullscreen:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }



        // Intersection Observer for performance optimization - DISABLED auto-play
		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				const video = entry.target.querySelector('video');
				if (!entry.isIntersecting && video && activeStreams.has(video.id)) {
					// Only pause videos that are out of view, don't auto-play
					video.pause();
				}
				// Removed auto-play when scrolling back into view
			});
		}, {
			threshold: 0.1
		});


		
		// Mobile menu functions
		function openMobileMenu() {
			document.getElementById('mobileSidebar').classList.add('active');
			document.getElementById('mobileMenuOverlay').classList.add('active');
			document.body.style.overflow = 'hidden';
		}

		function closeMobileMenu() {
			document.getElementById('mobileSidebar').classList.remove('active');
			document.getElementById('mobileMenuOverlay').classList.remove('active');
			document.body.style.overflow = 'auto';
		}

		function toggleDropdown(id) {
			const list = document.getElementById(id + '-list');
			// Close all other dropdowns first
			document.querySelectorAll('.custom-dropdown-list.open').forEach(el => {
				if (el.id !== id + '-list') el.classList.remove('open');
			});
			list.classList.toggle('open');
		}

		function openUrl(url, dropdownId) {
			window.open(url, '_blank');
			// Close dropdown and reset label
			document.getElementById(dropdownId + '-list').classList.remove('open');
		}

		// Close dropdowns when clicking outside
		document.addEventListener('click', function(e) {
			if (!e.target.closest('.custom-dropdown')) {
				document.querySelectorAll('.custom-dropdown-list.open').forEach(el => {
					el.classList.remove('open');
				});
			}
		});
    </script>

<!-- Add this before </body> tag -->
<div class="mobile-menu-overlay" id="mobileMenuOverlay" onclick="closeMobileMenu()"></div>
<div class="mobile-sidebar" id="mobileSidebar" dir="ltr">
    <div class="mobile-sidebar-header">
		<button class="hamburger-btn-main" onclick="closeMobileMenu()">
			<i class="fas fa-bars"></i>
		</button>
	</div>
    <div class="mobile-sidebar-content">
        <div class="mobile-tool-section">
            <h4><i class="fas fa-map"></i> War Maps</h4>
            <div class="custom-dropdown" id="warMapsDropdown">
				<button class="custom-dropdown-selected" onclick="toggleDropdown('warMapsDropdown')">
					<span>Select Map...</span>
					<i class="fas fa-chevron-down"></i>
				</button>
				<div class="custom-dropdown-list" id="warMapsDropdown-list">
					<div class="custom-dropdown-item disabled">Alerts</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.tzevaadom.co.il/', 'warMapsDropdown')">🚨 Tzofar - Tzeva Adom</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.oref.org.il/heb', 'warMapsDropdown')">🚨 Pikud Ha-oref</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">Conflict maps</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://hezbollah.liveuamap.com/', 'warMapsDropdown')">🔴 Hezbollah Map</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://lebanon.liveuamap.com/', 'warMapsDropdown')">🔴 Lebanon Map</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://israelpalestine.liveuamap.com/', 'warMapsDropdown')">🔴 Israel-Palestine Map</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.washingtoninstitute.org/hezbollahinteractivemap/', 'warMapsDropdown')">🔴 Lebanese Hezbollah</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://health.liveuamap.com/en/ukraine', 'warMapsDropdown')">🔴 Ukraine</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://isis.liveuamap.com/', 'warMapsDropdown')">🔴 ISIS Map</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://iran.liveuamap.com/', 'warMapsDropdown')">🔴 Iran Map</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">Military Deployment</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://experience.arcgis.com/experience/6893435f0297454a988ad2e6bf474a7b', 'warMapsDropdown')">🪖 Centcom - Middle East</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">Skies</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.flightradar24.com/34.00,36.33/7', 'warMapsDropdown')">✈️ Flight Radar 24</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.windy.com/?38.150,30.863,4,p:wind', 'warMapsDropdown')">🌨️ Windy</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.ventusky.com/#p=37.6;32.5;4', 'warMapsDropdown')">🌧️ Ventusky</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.mooncalc.org/#/51.5071,14.5886,3/2026.02.22/03:19/1/3', 'warMapsDropdown')">🌕 Moon Calculator</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://starwalk.space/en/moon-calendar', 'warMapsDropdown')">🌕 Starwalk Moon</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://satellitemap.space/', 'warMapsDropdown')">🛰️ StarLink</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">Sea</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.marinetraffic.com/en/ais/home/centerx:25.2/centery:36.7/zoom:6', 'warMapsDropdown')">🌊 Marine Traffic</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">Hazards</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://eq.gsi.gov.il/heb/earthquake/lastEarthquakes.php', 'warMapsDropdown')">🟤 Earthquakes</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://health.liveuamap.com/en/epidemics', 'warMapsDropdown')">🦠 Epidemics</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.gmcmap.com/', 'warMapsDropdown')">☢️ GMC Map</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://map.safecast.org/?y=32.19&x=44.76&z=7&l=0&m=0', 'warMapsDropdown')">☢️ SafeCast map</div>
				</div>
			</div>
        </div>
        <div class="mobile-tool-section">
            <h4><i class="fas fa-newspaper"></i> News Sites</h4>
            <div class="custom-dropdown" id="newsSitesDropdown">
				<button class="custom-dropdown-selected" onclick="toggleDropdown('newsSitesDropdown')">
					<span>Select News Site...</span>
					<i class="fas fa-chevron-down"></i>
				</button>
				<div class="custom-dropdown-list" id="newsSitesDropdown-list">
					<div class="custom-dropdown-item disabled">🇮🇱 Israeli</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.n12.co.il/', 'newsSitesDropdown')">N12</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.0404.co.il/', 'newsSitesDropdown')">0404</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.jpost.com/', 'newsSitesDropdown')">Jerusalem Post</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.timesofisrael.com/', 'newsSitesDropdown')">Times of Israel</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.zman.co.il/', 'newsSitesDropdown')">Zman Israel</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://rotter.net/', 'newsSitesDropdown')">Rotter</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.i24news.tv/en', 'newsSitesDropdown')">i24News</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.nziv.net/', 'newsSitesDropdown')">Nziv.net</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.calcalist.co.il', 'newsSitesDropdown')">Calcalist</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.globes.co.il', 'newsSitesDropdown')">Globes</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.haaretz.co.il', 'newsSitesDropdown')">Haaretz</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.themarker.com', 'newsSitesDropdown')">The Marker</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.mivzaklive.co.il', 'newsSitesDropdown')">Mivzak Live</div>
					<div class="custom-dropdown-item" onclick="openUrl('https://www.ynet.co.il/home/0,7340,L-8,00.html', 'newsSitesDropdown')">Ynet</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">🌍 Western</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://edition.cnn.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">CNN</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://edition.cnn.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.nbcnews.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">NBC</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.nbcnews.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://apnews.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">AP News</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://apnews.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.nytimes.com/international/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">New York Times</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.nytimes.com/international/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.bbc.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">BBC</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.bbc.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.reuters.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Reuters</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.reuters.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.wsj.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Wall Street Journal</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.wsj.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.washingtonpost.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Washington Post</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.washingtonpost.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.foxnews.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Fox News</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.foxnews.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.washingtoninstitute.org/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Washington Institute</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.washingtoninstitute.org/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.trtworld.com', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">TRT World</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.trtworld.com&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.spiegel.de/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Der Spiegel</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.spiegel.de/&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.spiegel.de/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.dw.com', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">DW News</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.dw.com&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.axios.com', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Axios</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.axios.com&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.politico.com', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Politico</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.politico.com&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.elpais.com', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">El País</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.elpais.com&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.elpais.com&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.elconfidencial.com', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">El Confidencial</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.elconfidencial.com&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.elconfidencial.com&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.euronews.com', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Euronews</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.euronews.com&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.ground.news', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Ground News</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.ground.news&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">🇶🇦 Qatar</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.aljazeera.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Al-Jazeera</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.aljazeera.com/&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.aljazeera.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">🇸🇦 Saudi Arabia</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://english.almayadeen.net/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Al-Mayadeen</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://english.almayadeen.net/&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://english.almayadeen.net/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.alhadath.net/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Al-Hadath</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.alhadath.net/&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.alhadath.net/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">🇮🇷 Iran</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.alalam.ir/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Al-Alam</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.alalam.ir/&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.alalam.ir/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">☠️ Hezbollah</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://english.alarabiya.net/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Al-Arabiya</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://english.alarabiya.net/&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://english.alarabiya.net/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://english.almanar.com.lb/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Al-Manar</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://english.almanar.com.lb/&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://english.almanar.com.lb/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">🇺🇸 US-funded Arabic</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.alhurra.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Al-Hurra</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.alhurra.com/&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.alhurra.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.shehabnews.com', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Shehab News</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.shehabnews.com&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.shehabnews.com&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.qudsn.net', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Quds News Network</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.qudsn.net&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.qudsn.net&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.al-akhbar.com', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Al-Akhbar</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.al-akhbar.com&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.al-akhbar.com&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://tasnimnews.ir', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Tasnim News</span>
						<span onclick="event.stopPropagation(); openUrl('https://tasnimnews.ir/en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://tasnimnews.ir/he', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.aqsatv.ps', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Al Aqsa TV</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.aqsatv.ps&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.aqsatv.ps&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.alquds.com/ar/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Al Quds</span>
						<span onclick="event.stopPropagation(); openUrl('https://www.alquds.com/en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://www.alquds.com/he', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://www.alquds.co.uk/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Al Quds Al Arabi</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.alquds.co.uk/&hl=en&sl=auto&tl=en', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.5rem; cursor:pointer;" title="Translate to English">🌐</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://www.alquds.co.uk/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item separator"></div>
					<div class="custom-dropdown-item disabled">📈 Poles</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://polymarket.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">polymarket</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://polymarket.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>
					<div class="custom-dropdown-item" style="display:flex; justify-content:space-between; align-items:center;">
						<span onclick="openUrl('https://usstrikeradar.com/', 'newsSitesDropdown')" style="flex:1; cursor:pointer;">Strike Radar</span>
						<span onclick="event.stopPropagation(); openUrl('https://translate.google.com/translate?u=https://usstrikeradar.com/&hl=iw&sl=auto&tl=iw', 'newsSitesDropdown')" style="font-size:1rem; padding-left:0.25rem; cursor:pointer;" title="Translate to Hebrew">🇮🇱</span>
					</div>				</div>
			</div>
        </div>
		<div class="mobile-tool-section" style="margin-top: -1.5rem;">
			<button class="ai-sum-btn" onclick="openAiSum(); closeMobileMenu();">
				<i class="fas fa-robot"></i> AI Summary
			</button>
		</div>

        <div class="mobile-tool-section">
            <h4><i class="fas fa-search"></i> Search Location</h4>
            <div style="display:flex;gap:0.5rem;align-items:center;">
				<input type="text" class="mobile-search-input" id="mobileSearchBox" placeholder="Search location..." style="flex:1;"
					onkeydown="if(event.key==='Enter'){event.preventDefault();var q=this.value.trim();if(q){window.open('https://www.google.com/maps/search/'+encodeURIComponent(q),'_blank');this.value='';closeMobileMenu();}}">
				<button onclick="var q=document.getElementById('mobileSearchBox').value.trim();if(q){window.open('https://www.google.com/maps/search/'+encodeURIComponent(q),'_blank');document.getElementById('mobileSearchBox').value='';closeMobileMenu();}" style="padding:0.75rem;background:rgba(79,70,229,0.8);border:none;border-radius:6px;color:white;font-size:1rem;cursor:pointer;flex-shrink:0;">
					<i class="fas fa-search"></i>
				</button>
			</div>
		</div>
    </div>
</div>
	
	<div class="ai-sum-overlay" id="aiSumOverlay">
		<div class="ai-sum-panel">

			<div class="ai-sum-header">
				<div class="ai-sum-title">
					<i class="fas fa-robot"></i>
					<span class="gradient-text">AI Summary</span>
					<span style="color:rgba(255,255,255,0.3); font-size:0.8rem; font-weight:400;">Top stories across all sources</span>
				</div>
				<button class="ai-sum-close" onclick="closeAiSum()">×</button>
			</div>

			<div class="ai-sum-controls">
				<button class="ai-sum-fetch-btn" id="aiSumFetchBtn" onclick="fetchAiSum()">
					<i class="fas fa-sync-alt"></i> Fetch News
				</button>
				<input type="password" class="gemini-key-input" id="geminiApiKey"
					placeholder="Gemini API key (optional — improves grouping)">
				<button class="gemini-enhance-btn" id="geminiEnhanceBtn" onclick="enhanceWithGemini()" disabled>
					<i class="fas fa-magic"></i> Enhance
				</button>
				<span class="ai-sum-status" id="aiSumStatus">Ready</span>
			</div>

			<div class="ai-sum-summary-bar" id="aiSumSummaryBar">
				<span><strong id="statStories">0</strong> stories</span>
				<span><strong id="statSources">0</strong> sources</span>
				<span><strong id="statArticles">0</strong> articles fetched</span>
				<span id="statGeminiBadge"></span>
				<span id="statTime" style="margin-left:auto; color:rgba(255,255,255,0.3);"></span>
			</div>

			<div class="ai-sum-loading" id="aiSumLoading">
				<div class="ai-sum-spinner"></div>
				<div>Fetching from sources...</div>
				<div class="ai-sum-progress" id="aiSumProgress">Connecting to GDELT...</div>
			</div>

			<div class="ai-sum-empty" id="aiSumEmpty">
				<i class="fas fa-newspaper" style="font-size:2rem; opacity:0.3;"></i>
				<span>Click "Fetch News" to load top stories</span>
			</div>

			<div class="ai-sum-list" id="aiSumList"></div>

		</div>
	</div>


	<script>
		const CORS_PROXY  = 'https://api.allorigins.win/raw?url=';
		const CORS_PROXY2 = 'https://corsproxy.io/?url=';

		const GDELT_URL = 'https://api.gdeltproject.org/api/v2/doc/doc?' +
			'query=israel%20OR%20iran%20OR%20gaza%20OR%20hezbollah%20OR%20lebanon%20OR%20hamas' +
			'&mode=artlist&maxrecords=75&format=json&timespan=24h&sort=hybridrel';

		const RSS_FEEDS = [
			{ name: 'Times of Israel', url: 'https://www.timesofisrael.com/feed/',             flag: '🇮🇱' },
			{ name: 'Jerusalem Post',  url: 'https://www.jpost.com/rss/rssfeedsfrontpage.aspx', flag: '🇮🇱' },
			{ name: 'i24 News',        url: 'https://www.i24news.tv/en/rss',                    flag: '🇮🇱' },
			{ name: 'Haaretz',         url: 'https://www.haaretz.com/cmlink/1.628765',          flag: '🇮🇱' },
			{ name: 'Al Jazeera',      url: 'https://www.aljazeera.com/xml/rss/all.xml',        flag: '🇶🇦' },
			{ name: 'BBC World',       url: 'https://feeds.bbci.co.uk/news/world/rss.xml',      flag: '🇬🇧' },
			{ name: 'Reuters',         url: 'https://feeds.reuters.com/reuters/topNews',        flag: '🌍' },
			{ name: 'CNN',             url: 'http://rss.cnn.com/rss/edition_world.rss',         flag: '🇺🇸' },
			{ name: 'Fox News',        url: 'https://moxie.foxnews.com/google-publisher/world.xml', flag: '🇺🇸' },
			{ name: 'France 24',       url: 'https://www.france24.com/en/rss',                  flag: '🇫🇷' },
			{ name: 'DW News',         url: 'https://rss.dw.com/rdf/rss-en-all',               flag: '🇩🇪' },
			{ name: 'Euronews',        url: 'https://feeds.feedburner.com/euronews/en/news/',   flag: '🇪🇺' },
			{ name: 'Press TV',        url: 'https://www.presstv.ir/rss',                       flag: '🇮🇷' },
			{ name: 'Al Arabiya',      url: 'https://www.alarabiya.net/tools/rss',              flag: '🇸🇦' },
		];

		const SOURCE_FLAGS = {
			'Times of Israel': 'il',
			'Jerusalem Post':  'il',
			'i24 News':        'il',
			'Haaretz':         'il',
			'Al Jazeera':      'qa',
			'BBC World':       'gb',
			'Reuters':         'gb',
			'CNN':             'us',
			'Fox News':        'us',
			'France 24':       'fr',
			'DW News':         'de',
			'Euronews':        'eu',
			'Press TV':        'ir',
			'Al Arabiya':      'sa',
		};

		function getSourceFlag(sourceName) {
			const code = SOURCE_FLAGS[sourceName];
			if (code) return `<img src="https://flagcdn.com/16x12/${code}.png" style="width:16px;height:12px;border-radius:2px;vertical-align:middle;">`;
			return '🌐';
		}

		const STOPWORDS = new Set([
			'the','a','an','and','or','but','in','on','at','to','for','of','with','by',
			'from','is','are','was','were','be','been','has','have','had','will','would',
			'can','could','should','may','might','that','this','these','those','it','its',
			'as','up','about','after','before','over','under','into','out','not','no',
			'new','says','say','said','report','reports','amid','more','than','also',
			'what','when','how','who','which','their','they',
			'في','من','إلى','على','عن','مع','هذا','هذه','ذلك','التي','الذي','لا','ما','إن','أن','كان','كانت','قال','قالت',
			'של','את','על','עם','הוא','היא','הם','זה','זאת','כי','אבל','גם','לא','יש',
		]);

		// Ordered by priority — first match wins
		const TOPIC_CATEGORIES = [
			{
				name: '⚔️ Military & Combat',
				keywords: [
					'attack','strike','airstrike','missile','rocket','drone','bomb','explosion',
					'troops','forces','military','army','navy','air force','idf','brigade',
					'war','battle','combat','offensive','operation','invasion','siege','frontline',
					'soldier','commander','general','admiral','fighter','jet','tank','artillery',
					'killed','wounded','casualties','fatalities','dead','destroyed',
					'hamas','hezbollah','jihad','qassam','izz ad-din',
					'captured','prisoner','raid','ambush','ceasefire','truce','hostage',
					'iron dome','air defense','interception','intercepted',
					'gunfire','shooting','sniper','mortar','rpg','explosive'
				]
			},
			{
				name: '🚨 Alerts & Incidents',
				keywords: [
					'alert','alarm','siren','red alert','code red','evacuation','shelter',
					'tzeva','tzofar','oref','pikud','warning','imminent',
					'emergency','incident','crisis','escalation','threat level'
				]
			},
			{
				name: '📡 Intelligence & Security',
				keywords: [
					'intelligence','mossad','cia','shin bet','shabak','mi6','spy','espionage',
					'classified','covert','operation','infiltration','surveillance',
					'cyber','hacking','hack','breach','leak','terror plot','cell','network',
					'arrest','detained','suspected','assassination','targeted'
				]
			},
			{
				name: '🤝 Diplomacy & Talks',
				keywords: [
					'ceasefire deal','peace deal','agreement','negotiations','talks','summit',
					'diplomat','diplomacy','mediation','mediator','proposal','framework',
					'hostage deal','prisoner exchange','release','blinken','sullivan',
					'secretary of state','foreign minister','envoy','delegation','visit',
					'united nations','un resolution','security council','veto',
					'normalization','abraham accords','two-state'
				]
			},
			{
				name: '⚖️ Politics & Law',
				keywords: [
					'election','vote','parliament','knesset','congress','senate',
					'court','law','legal','verdict','ruling','appeal','indictment',
					'corruption','coalition','opposition','party','cabinet','minister',
					'prime minister','president','government','policy','legislation',
					'protest','demonstration','rally','riot','revolution','coup',
					'netanyahu','biden','trump','harris','gantz','lapid','sinwar'
				]
			},
			{
				name: '💰 Economy & Finance',
				keywords: [
					'economy','financial','stock','market','shares','trading',
					'dollar','shekel','euro','currency','exchange rate',
					'inflation','gdp','budget','deficit','debt','surplus',
					'bank','interest rate','fed','central bank',
					'trade','sanction','embargo','export','import',
					'oil','gas','energy','commodity','wheat','grain',
					'investment','fund','billion','million','recession','growth',
					'nasdaq','dow jones','s&p','tel aviv stock exchange','tase'
				]
			},
			{
				name: '➕ Humanitarian',
				keywords: [
					'humanitarian','aid','relief','civilian','refugee','displaced',
					'hospital','medical','doctor','nurse','wounded','injured',
					'food','water','supply','shortage','famine','starvation',
					'children','women','orphan','shelter','camp','unrwa',
					'red cross','red crescent','unicef','who','msf','doctors without borders',
					'evacuation','corridor','safe passage','blockade aid'
				]
			},
			{
				name: '🌍 International',
				keywords: [
					'usa','united states','russia','china','europe','turkey',
					'egypt','jordan','saudi arabia','qatar','kuwait','uae',
					'france','germany','uk','britain','nato','g7','g20',
					'relations','bilateral','foreign policy','alliance','partnership'
				]
			},
			{
				name: '📰 General News',
				keywords: [] // catch-all, always matches last
			}
		];

		const SPONSORED_SIGNALS = [
			'sponsored','advertisement','advertorial','promoted','paid post',
			'paid content','partner content','brand studio','paid partnership',
			'presented by','brought to you by','in association with',
			'native ad','special advertising','commercial feature',
			'[ad]','[sponsored]','[promoted]'
		];

		function isSponsored(article) {
			const text = (article.title + ' ' + (article.url || '')).toLowerCase();
			return SPONSORED_SIGNALS.some(s => text.includes(s));
		}

		function categorizeStory(headline, articles) {
			const text = (headline + ' ' + articles.map(a => a.title).join(' ')).toLowerCase();
			for (const cat of TOPIC_CATEGORIES) {
				if (cat.keywords.length === 0) return cat.name; // catch-all
				if (cat.keywords.some(k => text.includes(k))) return cat.name;
			}
			return '📰 General News';
		}

		let allArticles = [];
		let groupedStories = [];

		function openAiSum() {
			document.getElementById('aiSumOverlay').classList.add('active');
			document.body.style.overflow = 'hidden';
			if (allArticles.length === 0) setTimeout(fetchAiSum, 200);
		}

		function closeAiSum() {
			document.getElementById('aiSumOverlay').classList.remove('active');
			document.body.style.overflow = 'auto';
		}

		async function fetchAiSum() {
			const btn      = document.getElementById('aiSumFetchBtn');
			const loading  = document.getElementById('aiSumLoading');
			const list     = document.getElementById('aiSumList');
			const empty    = document.getElementById('aiSumEmpty');
			const bar      = document.getElementById('aiSumSummaryBar');

			btn.disabled = true;
			loading.classList.add('active');
			list.innerHTML = '';
			empty.classList.remove('active');
			bar.classList.remove('active');
			allArticles = [];
			setStatus('Fetching...');
			setProgress('Connecting to GDELT...');

			try {
				const gdelt = await fetchGDELT();
				allArticles.push(...gdelt);
				setProgress(`GDELT: ${gdelt.length} articles. Fetching RSS...`);
			} catch(e) {
				setProgress('GDELT failed, continuing with RSS...');
			}

			const rssResults = await Promise.allSettled(RSS_FEEDS.map(f => fetchRSS(f)));
			rssResults.forEach(r => { if (r.status === 'fulfilled') allArticles.push(...r.value); });

			// Deduplicate by URL
			const seen = new Set();
			allArticles = allArticles.filter(a => {
				if (!a.url || seen.has(a.url)) return false;
				seen.add(a.url); return true;
			});

			// Remove sponsored content
			allArticles = allArticles.filter(a => !isSponsored(a));

			setProgress(`${allArticles.length} articles. Grouping...`);
			groupedStories = groupArticles(allArticles);

			loading.classList.remove('active');
			btn.disabled = false;

			if (groupedStories.length === 0) {
				empty.classList.add('active');
				setStatus('No stories found');
				return;
			}

			renderStories(groupedStories.slice(0, 50));

			document.getElementById('statStories').textContent  = Math.min(groupedStories.length, 50);
			document.getElementById('statSources').textContent  = new Set(allArticles.map(a => a.sourceName)).size;
			document.getElementById('statArticles').textContent = allArticles.length;
			document.getElementById('statGeminiBadge').innerHTML = '';
			document.getElementById('statTime').textContent = new Date().toLocaleTimeString();
			bar.classList.add('active');

			const key = document.getElementById('geminiApiKey').value.trim();
			document.getElementById('geminiEnhanceBtn').disabled = key.length < 10;
			setStatus(`${Math.min(groupedStories.length, 50)} stories from ${allArticles.length} articles`);
		}

		async function fetchGDELT() {
			const res = await fetchWithProxy(GDELT_URL);
			const data = await res.json();
			if (!data.articles) return [];
			return data.articles.map(a => ({
				title: decodeEntities(a.title || ''),
				url: a.url,
				sourceName: a.domain || extractDomain(a.url),
				flag: '🌐',
			}));
		}

		async function fetchRSS(feed) {
			let text;
			try {
				const r = await fetchWithTimeout(CORS_PROXY + encodeURIComponent(feed.url), 8000);
				text = await r.text();
			} catch(e) {
				const r = await fetchWithTimeout(CORS_PROXY2 + encodeURIComponent(feed.url), 7000);
				text = await r.text();
			}
			return parseRSS(text, feed);
		}

		function parseRSS(xmlText, feed) {
			const articles = [];
			try {
				const doc = new DOMParser().parseFromString(xmlText, 'text/xml');
				doc.querySelectorAll('item, entry').forEach(item => {
					const title = decodeEntities((item.querySelector('title')?.textContent || '').trim());
					const linkEl = item.querySelector('link');
					const url = linkEl?.getAttribute('href') || linkEl?.textContent?.trim() || '';
					if (title && url) articles.push({ title, url, sourceName: feed.name, flag: feed.flag });
				});
			} catch(e) {}
			return articles;
		}

		// ── TF-IDF grouping ──
		function tokenize(text) {
			return text.toLowerCase()
				.replace(/[^\w\s\u0590-\u05FF\u0600-\u06FF]/g, ' ')
				.split(/\s+/)
				.filter(w => w.length > 2 && !STOPWORDS.has(w));
		}

		function groupArticles(articles) {
			if (!articles.length) return [];
			const N = articles.length;
			const tfs = articles.map(a => {
				const tokens = tokenize(a.title);
				const tf = {};
				tokens.forEach(t => tf[t] = (tf[t]||0) + 1);
				const len = tokens.length || 1;
				Object.keys(tf).forEach(t => tf[t] /= len);
				return tf;
			});
			const df = {};
			tfs.forEach(tf => Object.keys(tf).forEach(t => df[t] = (df[t]||0) + 1));
			const vecs = tfs.map(tf => {
				const v = {};
				Object.keys(tf).forEach(t => {
					if (df[t] < N) v[t] = tf[t] * Math.log(N / df[t]);
				});
				return v;
			});

			const THRESHOLD = 0.18;
			const assigned = new Set();
			const groups = [];

			for (let i = 0; i < articles.length; i++) {
				if (assigned.has(i)) continue;
				const group = [i]; assigned.add(i);
				for (let j = i+1; j < articles.length; j++) {
					if (assigned.has(j)) continue;
					if (cosineSim(vecs[i], vecs[j]) >= THRESHOLD) { group.push(j); assigned.add(j); }
				}
				groups.push(group.map(idx => articles[idx]));
			}
			return groups.sort((a,b) => b.length - a.length);
		}

		function cosineSim(v1, v2) {
			let dot=0, m1=0, m2=0;
			new Set([...Object.keys(v1),...Object.keys(v2)]).forEach(k => {
				dot += (v1[k]||0)*(v2[k]||0);
				m1  += (v1[k]||0)**2;
				m2  += (v2[k]||0)**2;
			});
			return (!m1||!m2) ? 0 : dot/(Math.sqrt(m1)*Math.sqrt(m2));
		}

		// ── Gemini ──
		async function enhanceWithGemini() {
			const key = document.getElementById('geminiApiKey').value.trim();
			if (!key || !groupedStories.length) return;
			const btn = document.getElementById('geminiEnhanceBtn');
			btn.disabled = true;
			btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enhancing...';
			setStatus('Sending to Gemini...');

			const top60 = allArticles.slice(0,60).map((a,i) => `${i}: ${a.title}`).join('\n');
			const prompt = `Group these news headlines by story. Headlines in different languages about the same event = same group. Return ONLY a JSON array, no markdown:\n[{"group":0,"indices":[0,3,7],"headline":"Best English headline"},…]\n\nHeadlines:\n${top60}`;

			try {
				const res = await fetch(
					`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${key}`,
					{ method:'POST', headers:{'Content-Type':'application/json'},
					  body: JSON.stringify({ contents:[{parts:[{text:prompt}]}], generationConfig:{temperature:0.1,maxOutputTokens:2048} }) }
				);
				const data = await res.json();
				if (data.error) throw new Error(data.error.message);
				const raw = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
				const match = raw.match(/\[[\s\S]*\]/);
				if (!match) throw new Error('Invalid response');

				const geminiGroups = JSON.parse(match[0]);
				const top60a = allArticles.slice(0,60);
				const usedIdx = new Set(geminiGroups.flatMap(g => g.indices));
				const newGroups = geminiGroups.map(g => ({
					headline: g.headline,
					articles: g.indices.map(i => top60a[i]).filter(Boolean)
				})).filter(g => g.articles.length);

				top60a.forEach((a,i) => {
					if (!usedIdx.has(i)) newGroups.push({ headline: a.title, articles: [a] });
				});
				newGroups.sort((a,b) => b.articles.length - a.articles.length);
				renderStoriesEnhanced(newGroups.slice(0,50));

				document.getElementById('statGeminiBadge').innerHTML = '<span class="gemini-badge"><i class="fas fa-magic"></i> Gemini Enhanced</span>';
				document.getElementById('statStories').textContent = Math.min(newGroups.length,50);
				document.getElementById('aiSumSummaryBar').classList.add('active');
				setStatus(`Gemini grouped ${newGroups.length} stories`);
			} catch(e) {
				setStatus('Gemini error: ' + e.message);
			}
			btn.disabled = false;
			btn.innerHTML = '<i class="fas fa-magic"></i> Enhance';
		}

		function buildCategoryHeader(catName, count) {
			const header = document.createElement('div');
			header.style.cssText = `
				padding: 0.6rem 1rem 0.6rem 1.2rem;
				margin: 1.4rem 0 0.4rem 0;
				background: rgba(139,92,246,0.08);
				border-left: 4px solid #a78bfa;
				border-radius: 0 10px 10px 0;
				display: flex;
				align-items: center;
				justify-content: space-between;
			`;
			header.innerHTML = `
				<span style="font-size:1.1rem; font-weight:700; color:#a78bfa; letter-spacing:0.03em;">${catName}</span>
				<span style="
					font-size:0.72rem;
					font-weight:600;
					color:#a78bfa;
					background:rgba(139,92,246,0.12);
					border:1px solid rgba(167,139,250,0.4);
					border-radius:20px;
					padding:0.1rem 0.6rem;
				">${count} stories</span>
			`;
			return header;
		}

		// ── Render ──
		function renderStories(groups) {
			const list = document.getElementById('aiSumList');
			list.innerHTML = '';

			// Categorize all groups
			const categorized = {};
			TOPIC_CATEGORIES.forEach(cat => categorized[cat.name] = []);

			groups.forEach(articles => {
				const headline = pickHeadline(articles);
				const category = categorizeStory(headline, articles);
				if (!categorized[category]) categorized[category] = [];
				categorized[category].push({ articles, headline });
			});

			let globalRank = 1;

			// Render in TOPIC_CATEGORIES order (not by count — hierarchy matters)
			TOPIC_CATEGORIES.forEach(cat => {
				const categoryGroups = categorized[cat.name];
				if (!categoryGroups || categoryGroups.length === 0) return;

				// Sort within category by source count, cap at 25
				const sorted = categoryGroups
					.sort((a,b) => b.articles.length - a.articles.length)
					.slice(0, 25);

				// Category header
				list.appendChild(buildCategoryHeader(cat.name, sorted.length));

				sorted.forEach(({ articles, headline }) => {
					list.appendChild(buildCard(globalRank++, headline, articles));
				});
			});
		}

		function renderStoriesEnhanced(groups) {
			const list = document.getElementById('aiSumList');
			list.innerHTML = '';

			const categorized = {};
			TOPIC_CATEGORIES.forEach(cat => categorized[cat.name] = []);

			groups.forEach(g => {
				const category = categorizeStory(g.headline, g.articles);
				if (!categorized[category]) categorized[category] = [];
				categorized[category].push(g);
			});

			let globalRank = 1;

			TOPIC_CATEGORIES.forEach(cat => {
				const categoryGroups = categorized[cat.name];
				if (!categoryGroups || categoryGroups.length === 0) return;

				const sorted = categoryGroups
					.sort((a,b) => b.articles.length - a.articles.length)
					.slice(0, 25);

				list.appendChild(buildCategoryHeader(cat.name, sorted.length));

				sorted.forEach(g => list.appendChild(buildCard(globalRank++, g.headline, g.articles)));
			});
		}

		function buildCard(rank, headline, articles) {
			const count = articles.length;
			const badgeClass = count >= 5 ? 'badge-hot' : count >= 3 ? 'badge-warm' : 'badge-normal';
			const badgeLabel = count >= 5 ? `🟢 ${count} sources` : count >= 3 ? `🟡 ${count} sources` : `🔴 ${count} source${count>1?'s':''}`;
			const isRTL = /[\u0590-\u05FF\u0600-\u06FF]/.test(headline.slice(0,10));

			const seen = new Set();
			const unique = articles.filter(a => {
				const k = a.sourceName; if (seen.has(k)) return false; seen.add(k); return true;
			});

			const links = unique.map(a =>
				`<a class="source-link" href="${esc(a.url)}" target="_blank" rel="noopener">
					${getSourceFlag(a.sourceName)} ${esc(a.sourceName)}
				</a>`
			).join('');

			const card = document.createElement('div');
			card.className = 'story-card';
			card.dataset.rank = rank;
			card.innerHTML = `
				<div class="story-top">
					<span class="story-rank">#${rank}</span>
					<span class="story-badge ${badgeClass}">${badgeLabel}</span>
					<span class="story-headline" dir="${isRTL?'rtl':'ltr'}">${esc(headline)}</span>
				</div>
				<div class="story-headline-he" id="he-${rank}">⏳ מתרגם...</div>
				<div class="story-sources">${links}</div>`;

			// Translation runs after card is in DOM via MutationObserver trick
			requestAnimationFrame(() => translateToHebrew(headline, rank));

			return card;
		}

		async function translateToHebrew(text, rank) {
			// Already Hebrew - no need to translate
			if (/[\u0590-\u05FF]/.test(text)) {
				const el = document.getElementById('he-' + rank);
				if (el) el.textContent = text;
				return;
			}
			try {
				const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=iw&dt=t&q=${encodeURIComponent(text)}`;
				const res = await fetch(url);
				const data = await res.json();
				// Response structure: [[[translatedText, originalText, ...],...],...]
				const translated = data[0].reduce((acc, seg) => acc + (seg[0] || ''), '');
				const el = document.getElementById('he-' + rank);
				if (el) el.textContent = translated || '';
			} catch(e) {
				const el = document.getElementById('he-' + rank);
				if (el) el.textContent = '';
			}
		}

		function pickHeadline(articles) {
			const eng = articles.filter(a => !/[\u0590-\u05FF\u0600-\u06FF]/.test(a.title));
			const pool = eng.length ? eng : articles;
			return pool.reduce((b,a) => a.title.length > b.title.length ? a : b, pool[0]).title;
		}

		// ── Utils ──
		function fetchWithProxy(url) {
			return fetchWithTimeout(url, 8000);
		}
		function fetchWithTimeout(url, ms, options={}) {
			const ctrl = new AbortController();
			const id = setTimeout(() => ctrl.abort(), ms);
			return fetch(url, { ...options, signal: ctrl.signal }).finally(() => clearTimeout(id));
		}
		function decodeEntities(str) {
			const t = document.createElement('textarea'); t.innerHTML = str; return t.value;
		}
		function extractDomain(url) {
			try { return new URL(url).hostname.replace('www.',''); } catch(e) { return url; }
		}
		function esc(str) {
			return (str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
		}
		function setStatus(msg)   { document.getElementById('aiSumStatus').textContent   = msg; }
		function setProgress(msg) { document.getElementById('aiSumProgress').textContent = msg; }

		document.getElementById('aiSumOverlay').addEventListener('click', function(e) {
			if (e.target === this) closeAiSum();
		});
		
		document.getElementById('geminiApiKey').addEventListener('input', function() {
				document.getElementById('geminiEnhanceBtn').disabled =
					this.value.trim().length < 10 || groupedStories.length === 0;
			});
			
	</script>



</body>
</html>
